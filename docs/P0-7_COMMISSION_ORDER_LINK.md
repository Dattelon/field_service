# P0-7: –°–≤—è–∑—å –∫–æ–º–∏—Å—Å–∏—è ‚Üî –∑–∞–∫–∞–∑

**–î–∞—Ç–∞**: 2025-10-08  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P0 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)

---

## üìã –ü—Ä–æ–±–ª–µ–º–∞

**–ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è**:
- –ú–∞—Å—Ç–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–º–∏—Å—Å–∏–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "üí≥ –§–∏–Ω–∞–Ω—Å—ã"
- –í–∏–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–∏—Å—Å–∏–∏ (—Å—É–º–º–∞, –¥–µ–¥–ª–∞–π–Ω, —Å—Ç–∞—Ç—É—Å)
- –í–∏–¥–∏—Ç –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ (ID, –∞–¥—Ä–µ—Å, –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
- **–ù–ï–¢ —Å–ø–æ—Å–æ–±–∞** –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞
- –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –≤ "–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã" –∏ –∏—Å–∫–∞—Ç—å –∑–∞–∫–∞–∑ –≤—Ä—É—á–Ω—É—é

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```
–ú–∞—Å—Ç–µ—Ä: "üí≥ –§–∏–Ω–∞–Ω—Å—ã" ‚Üí –°–ø–∏—Å–æ–∫ –∫–æ–º–∏—Å—Å–∏–π
  ‚Üì
–ú–∞—Å—Ç–µ—Ä: –û—Ç–∫—Ä—ã–ª –∫–æ–º–∏—Å—Å–∏—é #456 (–∑–∞–∫–∞–∑ #123)
  ‚Üì
–ú–∞—Å—Ç–µ—Ä: [—Ö–æ—á–µ—Ç –≤—Å–ø–æ–º–Ω–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞]
  ‚Üì
–ú–∞—Å—Ç–µ—Ä: ‚ùå –í–æ–∑–≤—Ä–∞—Ç ‚Üí "–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã" ‚Üí –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞ #123
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ **"üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #{order_id}"** –≤ –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–º–∏—Å—Å–∏–∏.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª**: `field_service/bots/master_bot/handlers/finance.py`

```python
buttons: list[list[InlineKeyboardButton]] = []

# P0-7: –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∑–∞–∫–∞–∑—É
if order and order.id:
    buttons.append([
        InlineKeyboardButton(
            text=f"üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #{order.id}",
            callback_data=f"m:act:card:{order.id}"
        )
    ])

buttons.append([
    InlineKeyboardButton(text="üìÑ –†–µ–∫–≤–∏–∑–∏—Ç—ã", callback_data=f"m:fin:cm:pt:{commission.id}")
])
```

**–õ–æ–≥–∏–∫–∞**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ –∑–∞–∫–∞–∑ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (`order and order.id`)
2. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #{order_id}"
3. Callback –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `m:act:card:{order_id}` –∏–∑ `orders.py`
4. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –º–∞—Å—Ç–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –∫–∞—Ä—Ç–æ—á–∫–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

---

## üéØ –ù–æ–≤—ã–π UX Flow

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑

```
–ú–∞—Å—Ç–µ—Ä: "üí≥ –§–∏–Ω–∞–Ω—Å—ã" ‚Üí –ö–æ–º–∏—Å—Å–∏—è #456
  ‚Üì
–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏:
  üí≥ –ö–æ–º–∏—Å—Å–∏—è #456
  üìä –°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
  üí∞ –°—É–º–º–∞: 1500.00 ‚ÇΩ
  
  üì¶ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ:
  ‚Ä¢ –ó–∞–∫–∞–∑ #123 (–û–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑)
  ‚Ä¢ –ê–¥—Ä–µ—Å: –ú–æ—Å–∫–≤–∞, –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π, —É–ª. –õ–µ–Ω–∏–Ω–∞, 10
  
  [üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #123] ‚Üê –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê
  [üìÑ –†–µ–∫–≤–∏–∑–∏—Ç—ã]
  [üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —á–µ–∫]
  ‚Üì
–ú–∞—Å—Ç–µ—Ä: [–Ω–∞–∂–∞–ª "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #123"]
  ‚Üì
–ö–∞—Ä—Ç–æ—á–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ #123:
  üîµ –ó–∞–∫–∞–∑ #123
  üìç –ú–æ—Å–∫–≤–∞, –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π
  —É–ª. –õ–µ–Ω–∏–Ω–∞, 10
  ‚è∞ 10:00-12:00
  üìä –°—Ç–∞—Ç—É—Å: –ù–∞ –º–µ—Å—Ç–µ
  
  üë§ –ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
  üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 999 123-45-67
  
  [üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑]
  [üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –∑–∞–∫–∞–∑

```
–ú–∞—Å—Ç–µ—Ä: "üí≥ –§–∏–Ω–∞–Ω—Å—ã" ‚Üí –í—ã–ø–ª–∞—á–µ–Ω–æ ‚Üí –ö–æ–º–∏—Å—Å–∏—è #789
  ‚Üì
–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏:
  üí≥ –ö–æ–º–∏—Å—Å–∏—è #789
  üìä –°—Ç–∞—Ç—É—Å: –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
  üí∞ –°—É–º–º–∞: 2000.00 ‚ÇΩ
  
  üì¶ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ:
  ‚Ä¢ –ó–∞–∫–∞–∑ #456 (–û–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑)
  
  [üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #456] ‚Üê –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê
  ‚Üì
–ú–∞—Å—Ç–µ—Ä: [–Ω–∞–∂–∞–ª "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #456"]
  ‚Üì
–ï—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –∞–∫—Ç–∏–≤–Ω—ã–π:
  "–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤"
  [üîÑ –û–±–Ω–æ–≤–∏—Ç—å] [‚¨ÖÔ∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
  
  (–í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–∞)
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è callback –∏–∑ orders.py

```python
@router.callback_query(F.data.regexp(r"^m:act:card:(\d+)$"))
async def active_order_card(
    callback: CallbackQuery,
    session: AsyncSession,
    master: m.masters,
) -> None:
    order_id = int(callback.data.split(":")[-1])
    _log.info("active_order_card: uid=%s order_id=%s", _callback_uid(callback), order_id)
    await _render_active_order(callback, session, master, order_id=order_id)
    await safe_answer_callback(callback)
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ**:
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –∞–∫—Ç–∏–≤–Ω—ã–π (ASSIGNED, EN_ROUTE, WORKING, PAYMENT) ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –∞–∫—Ç–∏–≤–Ω—ã–π ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "NO_ACTIVE_ORDERS"

---

## üìä –ì–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞

–ö–Ω–æ–ø–∫–∞ "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑" –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–æ **–≤—Å–µ—Ö** —Ä–∞–∑–¥–µ–ª–∞—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤:

### 1. üí≥ –ö –æ–ø–ª–∞—Ç–µ
```
–ö–æ–º–∏—Å—Å–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏:
- WAIT_PAY (–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã)
- REPORTED (–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç—á—ë—Ç)

–ö–Ω–æ–ø–∫–∞: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞
```

### 2. ‚úÖ –í—ã–ø–ª–∞—á–µ–Ω–æ
```
–ö–æ–º–∏—Å—Å–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º:
- APPROVED (–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞)

–ö–Ω–æ–ø–∫–∞: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞
```

### 3. ‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ
```
–ö–æ–º–∏—Å—Å–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º:
- OVERDUE (–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ)

–ö–Ω–æ–ø–∫–∞: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç-–∫–µ–π—Å 1: –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∞–∫—Ç–∏–≤–Ω–æ–º—É –∑–∞–∫–∞–∑—É
```
1. –ú–∞—Å—Ç–µ—Ä: –ó–∞–≤–µ—Ä—à–∏–ª –∑–∞–∫–∞–∑ #123 (WORKING ‚Üí PAYMENT)
2. –ö–æ–º–∏—Å—Å–∏—è #456 —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. –ú–∞—Å—Ç–µ—Ä: "üí≥ –§–∏–Ω–∞–Ω—Å—ã" ‚Üí "–ö –æ–ø–ª–∞—Ç–µ"
4. –ú–∞—Å—Ç–µ—Ä: –û—Ç–∫—Ä—ã–ª –∫–æ–º–∏—Å—Å–∏—é #456
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ö–Ω–æ–ø–∫–∞ "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #123" –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
6. –ú–∞—Å—Ç–µ—Ä: [–Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É]
7. ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:
   - –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–∫–∞–∑–∞ #123
   - –°—Ç–∞—Ç—É—Å: PAYMENT (–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã)
   - –ö–Ω–æ–ø–∫–∏: [üîÑ –û–±–Ω–æ–≤–∏—Ç—å] [‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
```

### –¢–µ—Å—Ç-–∫–µ–π—Å 2: –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–º—É –∑–∞–∫–∞–∑—É
```
1. –ú–∞—Å—Ç–µ—Ä: –ó–∞–∫–∞–∑ #123 –æ–ø–ª–∞—á–µ–Ω –∏ –∑–∞–∫—Ä—ã—Ç (CLOSED)
2. –ö–æ–º–∏—Å—Å–∏—è #456 –æ–¥–æ–±—Ä–µ–Ω–∞
3. –ú–∞—Å—Ç–µ—Ä: "üí≥ –§–∏–Ω–∞–Ω—Å—ã" ‚Üí "–í—ã–ø–ª–∞—á–µ–Ω–æ"
4. –ú–∞—Å—Ç–µ—Ä: –û—Ç–∫—Ä—ã–ª –∫–æ–º–∏—Å—Å–∏—é #456
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ö–Ω–æ–ø–∫–∞ "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #123" –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
6. –ú–∞—Å—Ç–µ—Ä: [–Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É]
7. ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤"
   - –ö–Ω–æ–ø–∫–∏: [üîÑ –û–±–Ω–æ–≤–∏—Ç—å] [‚¨ÖÔ∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

### –¢–µ—Å—Ç-–∫–µ–π—Å 3: –ö–æ–º–∏—Å—Å–∏—è –±–µ–∑ –∑–∞–∫–∞–∑–∞ (edge case)
```
1. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é –±–µ–∑ order_id (–µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ)
2. –ú–∞—Å—Ç–µ—Ä: –û—Ç–∫—Ä—ã–ª –∫–æ–º–∏—Å—Å–∏—é
3. ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:
   - –ö–Ω–æ–ø–∫–∞ "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑" –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
```

### –¢–µ—Å—Ç-–∫–µ–π—Å 4: –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ
```
1. –ú–∞—Å—Ç–µ—Ä: –§–∏–Ω–∞–Ω—Å—ã ‚Üí –ö–æ–º–∏—Å—Å–∏—è #456
2. –ú–∞—Å—Ç–µ—Ä: [üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ #123]
3. –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞ #123
4. –ú–∞—Å—Ç–µ—Ä: [‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
5. ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:
   - –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
   - –ù–ï –≤–æ–∑–≤—Ä–∞—Ç –∫ –∫–æ–º–∏—Å—Å–∏–∏ (—Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
   
üí° –£–ª—É—á—à–µ–Ω–∏–µ (P1): –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ –∫–æ–º–∏—Å—Å–∏–∏
```

---

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–æ–≥ –∏–∑ `orders.py`:

```python
_log.info("active_order_card: uid=%s order_id=%s", _callback_uid(callback), order_id)
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞**:
```
[INFO] master_bot.orders: active_order_card: uid=12345 order_id=123
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
- **–ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: —Å–∫–æ–ª—å–∫–æ % –º–∞—Å—Ç–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞
- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è**: –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–∫–∞–∑—É ‚Üí –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–∑–∞–∫—Ä—ã—Ç–∏–µ, –∑–≤–æ–Ω–æ–∫)
- **Bounce rate**: —Å–∫–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä–æ–≤ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞–∑–∞–¥

---

## üéì –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (P1/P2)

### 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
```python
# –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –∑–∞–∫–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏
await state.update_data(return_to=f"m:fin:cm:{commission_id}")

# –í –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–∫–∞–∑–∞:
if return_to := (await state.get_data()).get("return_to"):
    buttons.append([
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–æ–º–∏—Å—Å–∏–∏", callback_data=return_to)
    ])
```

### 2. –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
```python
# –í–º–µ—Å—Ç–æ "NO_ACTIVE_ORDERS" –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
if order.status == m.OrderStatus.CLOSED:
    lines = [
        f"üì¶ –ó–∞–∫–∞–∑ #{order.id} (–∑–∞–≤–µ—Ä—à—ë–Ω)",
        f"üìç {address}",
        f"‚úÖ –ó–∞–∫—Ä—ã—Ç: {order.closed_at.strftime('%d.%m.%Y')}",
    ]
```

### 3. –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
```python
# –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –∞–∫—Ç–∏–≤–Ω—ã–π, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
if order.status == m.OrderStatus.PAYMENT:
    buttons.append([
        InlineKeyboardButton(
            text="üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É",
            url=f"tel:{order.client_phone}"
        )
    ])
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [x] –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `_render_commission_card`
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π callback `m:act:card:{order_id}`
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ edge cases
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ production
- [ ] –°–±–æ—Ä —Ñ–∏–¥–±–µ–∫–∞ –æ—Ç –º–∞—Å—Ç–µ—Ä–æ–≤

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `field_service/bots/master_bot/handlers/finance.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞
- `field_service/bots/master_bot/handlers/orders.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è callback `m:act:card:{order_id}`

---

## üéØ –°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

- **P1-9**: –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –º–∞—Å—Ç–µ—Ä–∞ (–ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã)
- **P0-6**: –í–æ–∑–≤—Ä–∞—Ç –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å–ø–∏—Å–∫–µ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
- **P1-20**: –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –∑–∞–∫–∞–∑—É (–¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö)

---

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫**: Claude Sonnet 4.5  
**–¢–∏–º–ª–∏–¥**: @username
