# 🧪 P1-19: Инструкция по тестированию

## Быстрый старт

### 1. Запуск ботов
```powershell
cd C:\ProjectF\field-service

# Master Bot
python -m field_service.bots.master_bot.main

# Admin Bot (в другом терминале)
python -m field_service.bots.admin_bot.main
```

---

## ✅ Тест Master Bot

### Сценарий 1: Копирование телефона клиента
1. Запустить master bot
2. Отправить `/start`
3. Включить смену (если выключена)
4. Принять любой заказ из "🆕 Новые заказы"
5. Открыть "📦 Активный заказ"
6. **Проверить:** Должны быть кнопки:
   - 📞 Позвонить клиенту (P0-4)
   - 📋 Телефон
   - 📋 Адрес

7. **Нажать "📋 Телефон"**
   - ✅ Должен появиться alert с телефоном клиента
   - ✅ Телефон должен быть в формате: +7XXXXXXXXXX
   - ✅ Текст alert можно скопировать

8. **Нажать "📋 Адрес"**
   - ✅ Должен появиться alert с адресом
   - ✅ Формат: "Город, Район, Улица, Дом"
   - ✅ Текст alert можно скопировать

### Сценарий 2: Заказ без телефона (edge case)
1. Создать заказ без телефона клиента (через admin bot)
2. Принять этот заказ
3. Открыть "📦 Активный заказ"
4. **Нажать "📋 Телефон"**
   - ✅ Должен появиться alert: "❌ Телефон не указан"

---

## ✅ Тест Admin Bot

### Сценарий 1: Копирование данных заказа
1. Запустить admin bot
2. Отправить `/start`
3. Выбрать "📋 Очередь заявок"
4. Выбрать любой заказ с назначенным мастером
5. **Проверить:** Должны быть кнопки:
   - 📋 Телефон клиента
   - 📋 Телефон мастера
   - 📋 Адрес

6. **Нажать "📋 Телефон клиента"**
   - ✅ Должен появиться alert с телефоном клиента
   - ✅ Формат: +7XXXXXXXXXX

7. **Нажать "📋 Телефон мастера"**
   - ✅ Должен появиться alert с телефоном мастера
   - ✅ Формат: +7XXXXXXXXXX

8. **Нажать "📋 Адрес"**
   - ✅ Должен появиться alert с полным адресом
   - ✅ Формат: "Город, Район, Улица, Дом"

### Сценарий 2: Заказ без мастера (edge case)
1. Выбрать заказ в статусе SEARCHING (без мастера)
2. **Нажать "📋 Телефон мастера"**
   - ✅ Должен появиться alert: "❌ Мастер не назначен или телефон не указан"
3. **Кнопки "📋 Телефон клиента" и "📋 Адрес" должны работать**

### Сценарий 3: Проверка прав доступа
1. Зайти под GLOBAL_ADMIN → все кнопки работают
2. Зайти под CITY_ADMIN → все кнопки работают
3. Зайти под LOGIST → все кнопки работают

---

## 🔍 Что проверять визуально

### Master Bot - Активный заказ
```
📦 Активный заказ #123
📍 Адрес: Москва, Центральный, ул. Ленина, 10
🗓 Слот: 10:00-12:00
🔁 Текущий статус: Назначено мастеру
🛠 Категория: Электрика
👤 Клиент: Иван Иванов
📞 Телефон: +79991234567

[🚗 В пути]
[📞 Позвонить клиенту]
[📋 Телефон] [📋 Адрес]    ← P1-19
[⬅️ Назад] [🏠 Меню]
```

### Admin Bot - Карточка заказа
```
🧾 Заказ #123
📍 Москва, Центральный, ул. Ленина, 10
🔧 Категория: Электрика
📦 Тип: NORMAL
⏰ Слот: 10:00-12:00
📌 Статус: ASSIGNED
🗓 Создан: 2024-10-09 08:30
👤 Клиент: Иван Иванов (+79991234567)
👤 Мастер: Пётр Петров (+79997654321)

[🛡 Гарантия]
[👥 Назначить]
[📋 Телефон клиента] [📋 Телефон мастера] [📋 Адрес]    ← P1-19
[⬅️ Назад] [✖️ Отменить]
[📋 К списку]
```

---

## 🐛 Известные проблемы

### Ограничение Telegram Alert
- Alert текст ограничен ~200 символами
- Для очень длинных адресов может обрезаться
- **Решение:** Текущая реализация покрывает 99% случаев

### Windows encoding в логах
- Если в print/log есть эмодзи → UnicodeEncodeError
- **Решение:** Используем только ASCII в логах

---

## 📊 Метрики успеха

После тестирования проверить:
- [ ] Все edge cases обработаны корректно
- [ ] Alert'ы появляются мгновенно (<500ms)
- [ ] Данные копируются корректно
- [ ] Нет ошибок в логах при использовании
- [ ] Кнопки не перекрывают другие элементы UI
- [ ] Работает на мобильных устройствах

---

## 🔄 Rollback план

Если что-то пойдёт не так:

```bash
# 1. Откатить изменения в master_bot
git checkout HEAD -- field_service/bots/master_bot/handlers/orders.py

# 2. Откатить изменения в admin_bot
git checkout HEAD -- field_service/bots/admin_bot/ui/keyboards/orders.py
git checkout HEAD -- field_service/bots/admin_bot/handlers/orders/__init__.py
rm field_service/bots/admin_bot/handlers/orders/copy_data.py

# 3. Удалить copy_utils
rm field_service/bots/common/copy_utils.py

# 4. Перезапустить ботов
```

---

**Готово к тестированию!** 🚀

Если нашёл баги - документируй в отдельном файле:
`C:\ProjectF\docs\P1-19_BUGS.md`
