# P1-17: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ ‚Äî –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª **"üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"** –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –º–∞—Å—Ç–µ—Ä–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏:
- ‚úÖ –ó–∞–∫–∞–∑–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (–≤—Å–µ–≥–æ)
- ‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞  
- ‚ö° –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
- üìÖ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞ –º–µ—Å—è—Ü

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
cd C:\ProjectF\field-service

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ
ls field_service/bots/master_bot/handlers/statistics.py
ls docs/P1-17_STATISTICS.md
ls tests/test_master_statistics.py
```

### 2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```powershell
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
cd C:\ProjectF\field-service

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
$env:PYTHONIOENCODING='utf-8'; pytest tests/test_master_statistics.py -v -s

# –ò–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –º–∞—Å—Ç–µ—Ä-–±–æ—Ç–∞
$env:PYTHONIOENCODING='utf-8'; pytest tests/test_master*.py -v
```

### 3. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞:**
   ```bash
   docker-compose up -d
   ```

2. **–û—Ç–∫—Ä—ã—Ç—å Telegram** ‚Üí –ù–∞–π—Ç–∏ –±–æ—Ç –º–∞—Å—Ç–µ—Ä–∞

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:**
   - –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ "üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
   - –ú–µ–∂–¥—É "üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞" –∏ "üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"

4. **–ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É:**
   - –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –î–ª—è –Ω–æ–≤–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞: –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ = 0 –∏–ª–∏ "‚Äî"
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–æ—Ç–∏–≤–∏—Ä—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç:**
   - –ö–Ω–æ–ø–∫–∞ "üè† –ú–µ–Ω—é" –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –ö–Ω–æ–ø–∫–∞ "üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –≤–∏–¥–Ω–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
- [ ] –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–º–∏–Ω/—á)
- [ ] –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- [ ] –ö–Ω–æ–ø–∫–∞ "üè† –ú–µ–Ω—é" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

### –î–∞–Ω–Ω—ã–µ
- [ ] –°—á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ CLOSED –∑–∞–∫–∞–∑—ã
- [ ] –†–µ–π—Ç–∏–Ω–≥ –±–µ—Ä—ë—Ç—Å—è –∏–∑ masters.rating
- [ ] –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è ACCEPTED –æ—Ñ—Ñ–µ—Ä–æ–≤
- [ ] –ó–∞ –º–µ—Å—è—Ü —Å—á–∏—Ç–∞—é—Ç—Å—è –∑–∞–∫–∞–∑—ã —Å updated_at >= –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞

### UI/UX
- [ ] –≠–º–æ–¥–∑–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ß–∏—Å–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å –Ω—É–∂–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é
- [ ] –¢–µ–∫—Å—Ç —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```
field_service/bots/master_bot/
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                  # ‚úèÔ∏è –î–æ–±–∞–≤–ª–µ–Ω import + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ statistics.py                # ‚ú® –ù–û–í–´–ô handler
‚îú‚îÄ‚îÄ keyboards.py                     # ‚úèÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤ –º–µ–Ω—é
‚îî‚îÄ‚îÄ texts.py                         # ‚úèÔ∏è –î–æ–±–∞–≤–ª–µ–Ω –∫–ª—é—á "statistics"

docs/
‚îî‚îÄ‚îÄ P1-17_STATISTICS.md              # ‚ú® –ù–û–í–ê–Ø –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

tests/
‚îî‚îÄ‚îÄ test_master_statistics.py        # ‚ú® –ù–û–í–´–ï —Ç–µ—Å—Ç—ã
```

---

## üêõ Troubleshooting

### –ö–Ω–æ–ø–∫–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ router –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
# –≤ master_bot/handlers/__init__.py:
from .statistics import router as statistics_router
router.include_router(statistics_router)
```

### –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls field_service/bots/master_bot/handlers/statistics.py
```

### –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ë–î —á–∏—Å—Ç–∞—è
docker exec -it field-service-db psql -U fsuser -d fsdb -c "SELECT COUNT(*) FROM orders"
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 0
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞
SELECT COUNT(*) 
FROM orders 
WHERE assigned_master_id = :master_id 
  AND status = 'CLOSED';
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –ù–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä (0 –∑–∞–∫–∞–∑–æ–≤)
```
üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

‚úÖ –ó–∞–∫–∞–∑–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: 0
‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: 5.0
‚ö° –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: ‚Äî
üìÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ –º–µ—Å—è—Ü: 0

üöÄ –ù–∞—á–Ω–∏—Ç–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–∫–∞–∑—ã, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å!

[üè† –ú–µ–Ω—é]
```

### –û–ø—ã—Ç–Ω—ã–π –º–∞—Å—Ç–µ—Ä (150 –∑–∞–∫–∞–∑–æ–≤)
```
üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

‚úÖ –ó–∞–∫–∞–∑–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: 150
‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: 4.8
‚ö° –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: 8 –º–∏–Ω
üìÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ –º–µ—Å—è—Ü: 23

üèÜ –í—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!

[üè† –ú–µ–Ω—é]
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ deploy:
- [x] –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ
- [ ] Code review –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã)
- [ ] Performance –ø—Ä–æ–≤–µ—Ä–µ–Ω (–∑–∞–ø—Ä–æ—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)

---

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ~1 —á–∞—Å  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–í—ã—Å–æ–∫–∏–π)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
