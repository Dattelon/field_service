# üêõ QUICKSTART: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è CITY_ADMIN

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û - –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ë–ê–ì:** CITY_ADMIN –≤–∏–¥–µ–ª **–í–°–ï 79 –≥–æ—Ä–æ–¥–æ–≤** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

**–ò–°–ü–†–ê–í–õ–ï–ù–û:** CITY_ADMIN –≤–∏–¥–∏—Ç **–¢–û–õ–¨–ö–û —Å–≤–æ–∏ –≥–æ—Ä–æ–¥–∞** (–∏–∑ `staff.city_ids`)

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –°–æ–∑–¥–∞—Ç—å CITY_ADMIN —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏

```sql
-- –ß–µ—Ä–µ–∑ admin-–±–æ—Ç –ø–æ–¥ GLOBAL_ADMIN:
1. –ü–µ—Ä–µ–π—Ç–∏: –ü–µ—Ä—Å–æ–Ω–∞–ª ‚Üí –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. –†–æ–ª—å: CITY_ADMIN
3. –ì–æ—Ä–æ–¥–∞: –í—ã–±—Ä–∞—Ç—å –¢–û–õ–¨–ö–û –ú–æ—Å–∫–≤–∞ –∏ –°–ü–± (–Ω–∞–ø—Ä–∏–º–µ—Ä)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
```

### 2. –ó–∞–π—Ç–∏ –ø–æ–¥ —ç—Ç–∏–º CITY_ADMIN

```
1. –û—Ç–∫—Ä—ã—Ç—å admin-–±–æ—Ç
2. –í–æ–π—Ç–∏ –ø–æ–¥ —Å–æ–∑–¥–∞–Ω–Ω—ã–º CITY_ADMIN
3. –ü–µ—Ä–µ–π—Ç–∏: –ó–∞—è–≤–∫–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
4. –í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**‚úÖ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
```
–°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¢–û–õ–¨–ö–û:
- –ú–æ—Å–∫–≤–∞
- –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥

(–Ω–∏–∫–∞–∫–∏—Ö –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ –±—ã—Ç—å –ù–ï –¥–æ–ª–∂–Ω–æ)
```

**‚ùå –ï—Å–ª–∏ –±–∞–≥ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω:**
```
–°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï:
- –ú–æ—Å–∫–≤–∞
- –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
- –ö–∞–∑–∞–Ω—å
- –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫
- ... (–≤—Å–µ 79 –≥–æ—Ä–æ–¥–æ–≤)
```

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### A. GLOBAL_ADMIN –≤–∏–¥–∏—Ç –≤—Å–µ –≥–æ—Ä–æ–¥–∞
```
1. –ó–∞–π—Ç–∏ –ø–æ–¥ GLOBAL_ADMIN
2. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
3. –í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥
‚úÖ –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –í–°–ï 79 –≥–æ—Ä–æ–¥–æ–≤
```

### B. CITY_ADMIN —Å 1 –≥–æ—Ä–æ–¥–æ–º
```
1. –°–æ–∑–¥–∞—Ç—å CITY_ADMIN —Å –≥–æ—Ä–æ–¥–æ–º "–ö–∞–∑–∞–Ω—å"
2. –ó–∞–π—Ç–∏ –ø–æ–¥ –Ω–∏–º
3. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
‚úÖ –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –¢–û–õ–¨–ö–û –ö–∞–∑–∞–Ω—å
```

### C. CITY_ADMIN –±–µ–∑ –≥–æ—Ä–æ–¥–æ–≤
```
1. –°–æ–∑–¥–∞—Ç—å CITY_ADMIN –±–µ–∑ –≥–æ—Ä–æ–¥–æ–≤ (city_ids = [])
2. –ó–∞–π—Ç–∏ –ø–æ–¥ –Ω–∏–º
3. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
‚úÖ –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å "–ì–æ—Ä–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
```

### D. –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
```
1. –ó–∞–π—Ç–∏ –ø–æ–¥ CITY_ADMIN (–ú–æ—Å–∫–≤–∞, –°–ü–±)
2. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ ‚Üí –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞
3. –í–≤–µ—Å—Ç–∏ "–ú–æ—Å"
‚úÖ –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ú–æ—Å–∫–≤—É
4. –í–≤–µ—Å—Ç–∏ "–ö–∞–∑"
‚úÖ –ù–∞—Ö–æ–¥–∏—Ç 0 –≥–æ—Ä–æ–¥–æ–≤ (–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ö–∞–∑–∞–Ω–∏)
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] GLOBAL_ADMIN –≤–∏–¥–∏—Ç –≤—Å–µ 79 –≥–æ—Ä–æ–¥–æ–≤
- [ ] CITY_ADMIN (–ú–æ—Å–∫–≤–∞, –°–ü–±) –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ 2 –≥–æ—Ä–æ–¥–∞
- [ ] CITY_ADMIN (–ö–∞–∑–∞–Ω—å) –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ 1 –≥–æ—Ä–æ–¥
- [ ] CITY_ADMIN (–Ω–µ—Ç –≥–æ—Ä–æ–¥–æ–≤) –≤–∏–¥–∏—Ç "–ì–æ—Ä–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
- [ ] –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- [ ] –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –≥–æ—Ä–æ–¥–∞–º" —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- [ ] –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö

---

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å admin-bot
docker-compose restart admin-bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f admin-bot
```

---

## üêõ Troubleshooting

### CITY_ADMIN –≤—Å—ë –µ—â—ë –≤–∏–¥–∏—Ç –≤—Å–µ –≥–æ—Ä–æ–¥–∞
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω:
```bash
grep "city_ids=city_ids" field_service/bots/admin_bot/handlers/orders/create.py
# –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ 2 —Å—Ç—Ä–æ–∫–∏ —Å city_ids=city_ids
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
docker-compose logs admin-bot | grep -i "error\|exception"
```

### GLOBAL_ADMIN –Ω–µ –≤–∏–¥–∏—Ç –≤—Å–µ –≥–æ—Ä–æ–¥–∞
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `visible_city_ids_for(GLOBAL_ADMIN)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`:
```python
# –í access.py:
if staff.role is StaffRole.GLOBAL_ADMIN:
    return None  # None = –≤—Å–µ –≥–æ—Ä–æ–¥–∞
```

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
services/orders.py       ‚úÖ +city_ids –ø–∞—Ä–∞–º–µ—Ç—Ä
handlers/orders/create.py ‚úÖ +staff –ø–∞—Ä–∞–º–µ—Ç—Ä, 5 –≤—ã–∑–æ–≤–æ–≤
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

**–ë–∞–≥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é.**  
**–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.**

**–î–µ—Ç–∞–ª–∏:** –°–º–æ—Ç—Ä–∏ `BUGFIX_CITY_ADMIN_FILTER.md`

---

**–í–∞–∂–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ù–û  
**–í—Ä–µ–º—è –Ω–∞ —Ç–µ—Å—Ç:** ~10 –º–∏–Ω—É—Ç
