# P1-15: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–æ–º–∏—Å—Å–∏–π - QUICKSTART

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
```bash
cd C:\ProjectF\field-service
docker-compose up -d
python -m field_service.bots.admin_bot.main
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å–º–æ—Ç—Ä –≥—Ä—É–ø–ø
```
1. –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–±–æ—Ç–∞
2. –ù–∞–∂–∞—Ç—å "üí∞ –§–∏–Ω–∞–Ω—Å—ã"
3. –ù–∞–∂–∞—Ç—å "üìä –ü–æ –ø–µ—Ä–∏–æ–¥–∞–º"
4. ‚úÖ –í–∏–¥–∏–º –º–µ–Ω—é —Å –≥—Ä—É–ø–ø–∞–º–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞–º–∏
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–∏—Å—Å–∏–π –ø–µ—Ä–∏–æ–¥–∞
```
1. –í –º–µ–Ω—é –≥—Ä—É–ø–ø –≤—ã–±—Ä–∞—Ç—å "üìÖ –°–µ–≥–æ–¥–Ω—è"
2. ‚úÖ –í–∏–¥–∏–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–∏—Å—Å–∏–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è
3. –ù–∞–∂–∞—Ç—å –Ω–∞ –ª—é–±—É—é –∫–æ–º–∏—Å—Å–∏—é
4. ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏
5. –ù–∞–∂–∞—Ç—å "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
6. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∫–æ–º–∏—Å—Å–∏–π (–Ω–µ –∫ –º–µ–Ω—é –≥—Ä—É–ø–ø!)
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–∞–≥–∏–Ω–∞—Ü–∏—è
```
1. –ï—Å–ª–∏ –∫–æ–º–∏—Å—Å–∏–π –±–æ–ª—å—à–µ 10
2. ‚úÖ –í–∏–¥–∏–º –∫–Ω–æ–ø–∫–∏ ‚óÄÔ∏è –ù–∞–∑–∞–¥ / ‚ñ∂Ô∏è –î–∞–ª–µ–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ callback data

–û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ callback:
```
adm:f:grouped:aw          # –ú–µ–Ω—é –≥—Ä—É–ø–ø
adm:f:grp:aw:today:1      # –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–∏–æ–¥–∞
adm:f:cm:card:123         # –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ RBAC

#### CITY_ADMIN
```python
# –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–º–∏—Å—Å–∏–∏ –∏–∑ —Å–≤–æ–∏—Ö –≥–æ—Ä–æ–¥–æ–≤
await session.execute(
    update(m.staff_users)
    .where(m.staff_users.id == test_admin_id)
    .values(role='CITY_ADMIN', city_ids=[1, 2])
)
```

#### GLOBAL_ADMIN
```python
# –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –≤—Å–µ –∫–æ–º–∏—Å—Å–∏–∏
await session.execute(
    update(m.staff_users)
    .where(m.staff_users.id == test_admin_id)
    .values(role='GLOBAL_ADMIN', city_ids=None)
)
```

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ callback handlers –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã:
```python
# –í admin_bot/handlers/__init__.py –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç
from .finance import router as finance_router
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ì—Ä—É–ø–ø—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –≤ –ë–î:
```sql
SELECT 
    DATE(created_at) as date,
    status,
    COUNT(*) as count
FROM commissions
WHERE status IN ('WAIT_PAY', 'REPORTED')
GROUP BY DATE(created_at), status
ORDER BY date DESC;
```

### –ü—Ä–æ–±–ª–µ–º–∞: Import Error
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ:
```python
# –í admin_bot/handlers/finance/main.py
from ...core.access import visible_city_ids_for
from ...ui.keyboards import (
    finance_grouped_keyboard,
    finance_group_period_keyboard,
)
```

---

## üìä SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```sql
-- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã
INSERT INTO commissions (order_id, master_id, amount, status, created_at)
VALUES 
    -- –°–µ–≥–æ–¥–Ω—è
    (1, 1, 1500, 'WAIT_PAY', NOW()),
    (2, 2, 2300, 'WAIT_PAY', NOW()),
    
    -- –í—á–µ—Ä–∞
    (3, 1, 800, 'WAIT_PAY', NOW() - INTERVAL '1 day'),
    (4, 2, 1200, 'WAIT_PAY', NOW() - INTERVAL '1 day'),
    
    -- –ù–µ–¥–µ–ª—è –Ω–∞–∑–∞–¥
    (5, 1, 3000, 'WAIT_PAY', NOW() - INTERVAL '5 days'),
    
    -- –ú–µ—Å—è—Ü –Ω–∞–∑–∞–¥
    (6, 2, 950, 'WAIT_PAY', NOW() - INTERVAL '20 days');
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –ö–Ω–æ–ø–∫–∞ "üìä –ü–æ –ø–µ—Ä–∏–æ–¥–∞–º" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –º–µ–Ω—é –§–∏–Ω–∞–Ω—Å–æ–≤
- [ ] –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é –≥—Ä—É–ø–ø
- [ ] –ì—Ä—É–ø–ø—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∏—Å—Å–∏–π
- [ ] –ü—É—Å—Ç—ã–µ –≥—Ä—É–ø–ø—ã —Å–∫—Ä—ã—Ç—ã
- [ ] –ö–ª–∏–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–∏—Å—Å–∏–π
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å–ª–∏ –∫–æ–º–∏—Å—Å–∏–π >10)
- [ ] –ö–ª–∏–∫ –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É
- [ ] –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–¥—ë—Ç –≤ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–∏–æ–¥–∞, –∞ –Ω–µ –≤ –º–µ–Ω—é –≥—Ä—É–ø–ø
- [ ] RBAC —Ä–∞–±–æ—Ç–∞–µ—Ç (CITY_ADMIN –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –≥–æ—Ä–æ–¥–∞)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üéâ
