# ‚úÖ –°–ö–†–ò–ü–¢–´ –î–õ–Ø –°–ù–ê–ü–®–û–¢–û–í –ë–î - –ì–û–¢–û–í–û

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-07  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

## üìÇ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–∫—Ä–∏–ø—Ç—ã –≤ `C:\ProjectF\field-service\scripts\`

1. **quick_db_snapshot.ps1** ‚ö° (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
   - –ë—ã—Å—Ç—Ä—ã–π —Å–Ω–∞–ø—à–æ—Ç —á–µ—Ä–µ–∑ pg_dump
   - –°–æ–∑–¥–∞–µ—Ç SQL + TXT —Ñ–∞–π–ª—ã
   - ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~5-10 —Å–µ–∫—É–Ω–¥

2. **create_db_snapshot.ps1** üìä
   - –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç —Å –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
   - –î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∏–Ω–¥–µ–∫—Å—ã, FK, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
   - –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, –Ω–æ –¥–∞—ë—Ç –º–∞–∫—Å–∏–º—É–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

3. **db_structure_snapshot.py** üêç
   - Python —Å–∫—Ä–∏–ø—Ç —Å asyncpg
   - –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î
   - –¢—Ä–µ–±—É–µ—Ç: `pip install asyncpg`

4. **README_DB_SNAPSHOTS.md** üìñ
   - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤—Å–µ–º —Å–∫—Ä–∏–ø—Ç–∞–º
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
   - –ü—Ä–∏–º–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
```
scripts/
‚îú‚îÄ‚îÄ db_schema_2025-10-07_165709.sql        (53.44 KB)  ‚Üê SQL —Å—Ö–µ–º–∞
‚îî‚îÄ‚îÄ db_structure_2025-10-07_165709.txt     (57.16 KB)  ‚Üê –ß–∏—Ç–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è
```

### –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–Ω–∞–ø—à–æ—Ç–∞:
```
================================================================================
DATABASE STRUCTURE: field_service
================================================================================
Created: 2025-10-07 16:57:09

STATISTICS:
--------------------------------------------------------------------------------
Tables: 25 
ENUM types: 12 
Sequences: 17 
Database size: 10021 kB 

TABLES:
--------------------------------------------------------------------------------
        table_name        | rows 
--------------------------+------
 districts                |  365  ‚Üê –≤—Å–µ —Ä–∞–π–æ–Ω—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã!
 cities                   |   79  ‚Üê –≤—Å–µ –≥–æ—Ä–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã!
 staff_users              |    5
 settings                 |    1
 skills                   |    1
 order_status_history     |    1
 admin_audit_log          |    1
 orders                   |    1
 ... (25 —Ç–∞–±–ª–∏—Ü –≤—Å–µ–≥–æ)

SQL SCHEMA:
--------------------------------------------------------------------------------
-- PostgreSQL database dump
-- Version 15.14

CREATE TYPE public.attachment_entity AS ENUM (
    'ORDER',
    'MASTER'
);

CREATE TYPE public.master_finance_status AS ENUM (
    'PENDING',
    'PAID',
    'OVERDUE',
    ...
);

CREATE TABLE public.cities (
    id integer NOT NULL,
    name character varying(120) NOT NULL,
    is_active boolean DEFAULT true,
    timezone character varying(64),
    ...
);

... (–ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü, –∏–Ω–¥–µ–∫—Å–æ–≤, constraints)
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å–Ω–∞–ø—à–æ—Ç (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å):
```powershell
cd C:\ProjectF\field-service\scripts
.\quick_db_snapshot.ps1
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç (–ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏):
```powershell
cd C:\ProjectF\field-service\scripts
.\create_db_snapshot.ps1
```

### Python —Å–Ω–∞–ø—à–æ—Ç (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏):
```powershell
cd C:\ProjectF\field-service\scripts
python db_structure_snapshot.py
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π:** –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–Ω–∞–ø—à–æ—Ç `quick_db_snapshot.ps1`
2. **–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é:** –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç `create_db_snapshot.ps1`
3. **–í Git:** –•—Ä–∞–Ω–∏—Ç–µ —Å–Ω–∞–ø—à–æ—Ç—ã –≤ –ø–∞–ø–∫–µ `migrations/snapshots/`
4. **–î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `git diff` –º–µ–∂–¥—É —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏

## üìù –ß—Ç–æ –ø–æ–ø–∞–ª–æ –≤ —Å–Ω–∞–ø—à–æ—Ç

### ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –Ω–∞ 2025-10-07:
- **25 —Ç–∞–±–ª–∏—Ü** (orders, masters, cities, districts, offers, –∏ —Ç.–¥.)
- **12 ENUM —Ç–∏–ø–æ–≤** (order_status, master_finance_status, offer_state, –∏ —Ç.–¥.)
- **17 sequences** (–¥–ª—è auto-increment ID)
- **365 —Ä–∞–π–æ–Ω–æ–≤** (–≤—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã!)
- **79 –≥–æ—Ä–æ–¥–æ–≤** (78 —Ä–µ–∞–ª—å–Ω—ã—Ö + Test City)
- **–í—Å–µ –∏–Ω–¥–µ–∫—Å—ã** (primary keys, foreign keys, unique constraints)
- **–í—Å–µ constraints** (foreign key constraints —Å ON DELETE/UPDATE)

## üîç –ö–∞–∫ —á–∏—Ç–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç

### SQL —Ñ–∞–π–ª (db_schema_*.sql):
- –ß–∏—Å—Ç—ã–π SQL –∫–æ–¥
- –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã: `psql -U fs_user -d new_db -f db_schema_*.sql`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π –ë–î

### TXT —Ñ–∞–π–ª (db_structure_*.txt):
- –ß–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- –ü–æ–ª–Ω–∞—è SQL —Å—Ö–µ–º–∞ –≤–Ω–∏–∑—É

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ:
1. ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
2. ‚úÖ –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
3. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î
4. ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å—Ö–µ–º—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

```powershell
# –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∂–¥–æ–≥–æ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞:
cd C:\ProjectF\field-service\scripts
.\quick_db_snapshot.ps1
```

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: 2025-10-07 16:58*  
*–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ PostgreSQL 15.14*
