# üöÄ CI/CD Workflow –¥–ª—è Field Service

## üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
[–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞] ‚Üí [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ] ‚Üí [–î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä] ‚Üí [Graceful restart]
    ‚Üì                        ‚Üì                    ‚Üì                      ‚Üì
–¢–µ—Å—Ç–æ–≤–∞—è –ë–î          –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã      –ê–≤—Ç–æ–±—ç–∫–∞–ø –ë–î        Zero-downtime
```

## üîÑ WORKFLOW –†–ê–ó–†–ê–ë–û–¢–ö–ò

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–£ —Ç–µ–±—è –ª–æ–∫–∞–ª—å–Ω–æ:**
- –ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞: `C:\ProjectF\field-service`
- –¢–µ—Å—Ç–æ–≤–∞—è –ë–î: PostgreSQL –Ω–∞ –ø–æ—Ä—Ç—É 5439
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –±–æ—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ—Ü–µ—Å—Å:**
```bash
# 1. –í–Ω–æ—Å–∏—à—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥
# 2. –ó–∞–ø—É—Å–∫–∞–µ—à—å —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ
cd C:\ProjectF\field-service
python -m pytest tests/

# 3. –¢–µ—Å—Ç–∏—Ä—É–µ—à—å –±–æ—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ
python -m field_service.bots.admin_bot.main
python -m field_service.bots.master_bot.main
```

### 2. –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω (—Å–µ—Ä–≤–µ—Ä)

**–ò—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è:**
```powershell
# –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è!
C:\ProjectF\deploy_to_production.ps1
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. ‚úÖ –°–æ–∑–¥–∞—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
2. ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–π –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. ‚úÖ –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã
5. ‚úÖ –î–µ–ª–∞–µ—Ç graceful restart (–ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### 3. –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```powershell
C:\ProjectF\rollback_deployment.ps1
```

**–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç:**
- –ü—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞
- –ë—ç–∫–∞–ø –ë–î
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é

---

## üóÑÔ∏è –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ë–≠–ö–ê–ü–´ –ë–î

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

**1. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã (2:00 –Ω–æ—á–∏)**
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ `/opt/backups/daily/`
- –•—Ä–∞–Ω—è—Ç—Å—è 7 –¥–Ω–µ–π
- –§–æ—Ä–º–∞—Ç: `field_service_YYYYMMDD_HHMMSS.sql.gz`

**2. –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 3:00)**
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ `/opt/backups/weekly/`
- –•—Ä–∞–Ω—è—Ç—Å—è 4 –Ω–µ–¥–µ–ª–∏

**3. –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –±—ç–∫–∞–ø—ã (1-–≥–æ —á–∏—Å–ª–∞ 4:00)**
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ `/opt/backups/monthly/`
- –•—Ä–∞–Ω—è—Ç—Å—è 12 –º–µ—Å—è—Ü–µ–≤

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø (–ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º):
```powershell
C:\ProjectF\backup_database.ps1
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞:
```powershell
C:\ProjectF\restore_database.ps1 -BackupFile "–∏–º—è_—Ñ–∞–π–ª–∞.sql.gz"
```

---

## ‚ö° GRACEFUL RESTART (Zero-Downtime)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º –∫–æ–¥–æ–º
2. **–°—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** –ø–æ–∫–∞ –Ω–æ–≤—ã–µ –Ω–µ –≥–æ—Ç–æ–≤—ã
3. **–ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –∫–æ–≥–¥–∞ –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≥–æ—Ç–æ–≤—ã
4. **–°—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è** gracefully

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∑–∞–º–µ—á–∞—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫! üéâ

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ë–≠–ö–ê–ü–û–í

```
/opt/backups/
‚îú‚îÄ‚îÄ daily/
‚îÇ   ‚îú‚îÄ‚îÄ field_service_20251010_020000.sql.gz (7 –¥–Ω–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ field_service_20251009_020000.sql.gz
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ weekly/
‚îÇ   ‚îú‚îÄ‚îÄ field_service_week_41_2025.sql.gz (4 –Ω–µ–¥–µ–ª–∏)
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ monthly/
    ‚îú‚îÄ‚îÄ field_service_2025_10.sql.gz (12 –º–µ—Å—è—Ü–µ–≤)
    ‚îî‚îÄ‚îÄ ...
```

---

## üéØ –ë–´–°–¢–†–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø (–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞)

### –£—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
```powershell
# 1. –û—Ç–∫—Ä–æ–π –ø—Ä–æ–µ–∫—Ç
cd C:\ProjectF\field-service

# 2. –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥
# (—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª—ã)

# 3. –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã
pytest tests/

# 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –ª–æ–∫–∞–ª—å–Ω–æ
python -m field_service.bots.admin_bot.main
```

### –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥ (–∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ):
```powershell
# –û–î–ù–ê –ö–û–ú–ê–ù–î–ê –î–õ–Ø –í–°–ï–ì–û!
C:\ProjectF\deploy_to_production.ps1

# –ò–ª–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
C:\ProjectF\deploy_to_production.ps1 -SkipTests $false -CreateBackup $true
```

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:
```powershell
# –û—Ç–∫–∞—Ç–∏—Ç—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
C:\ProjectF\rollback_deployment.ps1
```

---

## üîç –ú–û–ù–ò–¢–û–†–ò–ù–ì –ü–û–°–õ–ï –î–ï–ü–õ–û–Ø

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≤ —Å–∫—Ä–∏–ø—Ç–µ –¥–µ–ø–ª–æ—è):
- ‚úÖ –ë–æ—Ç—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- ‚úÖ Heartbeat —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
C:\ProjectF\check_server_health.ps1

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
C:\ProjectF\view_server_logs.ps1
```

---

## üìä CI/CD –î–õ–Ø –ü–†–û–î–í–ò–ù–£–¢–´–• (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë –±–æ–ª—å—à–µ:

### GitHub Actions (–±—É–¥—É—â–µ–µ):
```yaml
# .github/workflows/deploy.yml
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
      - –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
      - –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
```

### GitLab CI (–±—É–¥—É—â–µ–µ):
```yaml
# .gitlab-ci.yml
stages:
  - test
  - backup
  - deploy
  - verify
```

**–ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—ã–µ PowerShell —Å–∫—Ä–∏–ø—Ç—ã!** (–ø—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ)

---

## üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –ë—ç–∫–∞–ø—ã:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤ –æ–±–ª–∞–∫–µ

### –î–µ–ø–ª–æ–π:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- ‚úÖ –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

## üìù –õ–û–ì–ò –î–ï–ü–õ–û–Ø

–í—Å–µ –¥–µ–ø–ª–æ–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤:
- `C:\ProjectF\deployment_logs\deploy_YYYYMMDD_HHMMSS.log`

–§–æ—Ä–º–∞—Ç:
```
[2025-10-10 15:30:00] START DEPLOYMENT
[2025-10-10 15:30:05] Creating backup...
[2025-10-10 15:30:15] Backup created: backup_20251010_153015.sql.gz
[2025-10-10 15:30:20] Uploading code...
[2025-10-10 15:31:30] Building Docker images...
[2025-10-10 15:32:45] Running migrations...
[2025-10-10 15:33:00] Graceful restart...
[2025-10-10 15:33:15] Health check: PASSED
[2025-10-10 15:33:20] DEPLOYMENT SUCCESS
```

---

## üéì –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```powershell
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤
C:\ProjectF\list_backups.ps1

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
C:\ProjectF\cleanup_old_backups.ps1

# –°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø —Å —Å–µ—Ä–≤–µ—Ä–∞
C:\ProjectF\download_backup.ps1 -BackupName "–∏–º—è.sql.gz"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ë–î
C:\ProjectF\check_database_size.ps1
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î –î–ï–ü–õ–û–ï–ú

- [ ] –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (`pytest`)
- [ ] –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö TODO –≤ –∫–æ–¥–µ
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω CHANGELOG.md
- [ ] –ì–æ—Ç–æ–≤ –∫ –æ—Ç–∫–∞—Ç—É (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫)

---

**–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã!** ‚Üí
