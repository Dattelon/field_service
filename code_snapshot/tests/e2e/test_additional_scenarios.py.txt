"""
ADDITIONAL SCENARIOS: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (5-8)
================================================================

–°—Ü–µ–Ω–∞—Ä–∏–∏ 5-8 –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–µ –∑–∞—è–≤–∫–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
- No-show (–º–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏—à—ë–ª)
- –°–ø–æ—Ä—ã –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ—Å—Ä–æ—á–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
"""

import pytest
import asyncio
from datetime import datetime, timedelta
from test_order_lifecycle_all_scenarios import TestLogger


# ============================================================================
# SCENARIO 5: –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω–∞—è –∑–∞—è–≤–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø—Ä–µ–∂–Ω–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞
# ============================================================================

@pytest.mark.e2e
@pytest.mark.critical
@pytest.mark.asyncio
async def test_scenario_5_warranty_request(bot_client, bot_master, db):
    """
    –°–¶–ï–ù–ê–†–ò–ô 5: –ì–ê–†–ê–ù–¢–ò–ô–ù–ê–Ø –ó–ê–Ø–í–ö–ê
    
    –§–ª–æ—É:
    –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –æ–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑ ‚Üí –ú–∞—Å—Ç–µ—Ä –ê –≤—ã–ø–æ–ª–Ω—è–µ—Ç ‚Üí
    ‚Üí –ß–µ—Ä–µ–∑ 2 –¥–Ω—è –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π–∫—É ‚Üí
    ‚Üí –û—Ñ—Ñ–µ—Ä –°–ù–ê–ß–ê–õ–ê –º–∞—Å—Ç–µ—Ä—É –ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) ‚Üí
    ‚Üí –ï—Å–ª–∏ –ø—Ä–∏–Ω—è–ª: company_payment=true (–∫–æ–º–∏—Å—Å–∏—è 0%) ‚Üí
    ‚Üí –ï—Å–ª–∏ –∏–≥–Ω–æ—Ä–∏–ª: –æ—Ñ—Ñ–µ—Ä –¥—Ä—É–≥–∏–º –º–∞—Å—Ç–µ—Ä–∞–º (–æ–±—ã—á–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è)
    """
    log = TestLogger()
    log.section("–°–¶–ï–ù–ê–†–ò–ô 5: –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω–∞—è –∑–∞—è–≤–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø—Ä–µ–∂–Ω–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞")
    
    # --- –ß–ê–°–¢–¨ 1: –û–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑ ---
    log.section("–ß–ê–°–¢–¨ 1: –û–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑ (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)")
    
    log.action("–ö–ª–∏–µ–Ω—Ç ID=1003", "–°–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑")
    log.db_write("orders", "INSERT", {
        "id": 5006,
        "client_id": 1003,
        "status": "searching",
        "address": "–£–ª. –ë—Ä–∏–≤–∏–±–∞—Å 10"
    })
    
    log.system_event("–ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ", "–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π (ID=2010) –Ω–∞–∑–Ω–∞—á–µ–Ω")
    log.db_write("orders", "UPDATE", {
        "id": 5006,
        "status": "assigned",
        "master_id": 2010
    })
    
    log.action("–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π", "–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É")
    log.db_write("orders", "UPDATE", {
        "id": 5006,
        "status": "completed",
        "total_amount": 80.00,
        "completed_at": "2025-10-05 10:00:00"
    })
    
    log.action("–ö–ª–∏–µ–Ω—Ç", "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —Å—Ç–∞–≤–∏—Ç 5‚òÖ")
    log.db_write("ratings", "INSERT", {
        "order_id": 5006,
        "master_id": 2010,
        "rating": 5,
        "comment": "–û—Ç–ª–∏—á–Ω–æ!"
    })
    
    log.success("–û–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑ –∑–∞–∫—Ä—ã—Ç —É—Å–ø–µ—à–Ω–æ")
    
    # --- –ß–ê–°–¢–¨ 2: –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω–∞—è –∑–∞—è–≤–∫–∞ —á–µ—Ä–µ–∑ 2 –¥–Ω—è ---
    log.section("–ß–ê–°–¢–¨ 2: –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—É—é –∑–∞—è–≤–∫—É (—á–µ—Ä–µ–∑ 2 –¥–Ω—è)")
    
    log.timing("–ü—Ä–æ—à–ª–æ –≤—Ä–µ–º–µ–Ω–∏", 172800.0)  # 48 —á–∞—Å–æ–≤
    
    log.action("–ö–ª–∏–µ–Ω—Ç ID=1003", "–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑")
    log.message_received("–ö–ª–∏–µ–Ω—Ç", "/create_order")
    log.button_click("–ö–ª–∏–µ–Ω—Ç", "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑", "create_order")
    
    # –ê–¥—Ä–µ—Å —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π (—Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç)
    log.message_received("–ö–ª–∏–µ–Ω—Ç", "–£–ª. –ë—Ä–∏–≤–∏–±–∞—Å 10")
    log.system_event("–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏", "–ù–∞–π–¥–µ–Ω –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–∫–∞–∑ ‚Ññ5006 –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É")
    
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–ü–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É –±—ã–ª –∑–∞–∫–∞–∑ ‚Ññ5006. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å–ª—É—á–∞–π?", has_buttons=True)
    
    log.button_click("–ö–ª–∏–µ–Ω—Ç", "‚úÖ –î–∞, –≥–∞—Ä–∞–Ω—Ç–∏—è", "warranty:5006")
    
    log.db_write("orders", "INSERT", {
        "id": 5007,
        "client_id": 1003,
        "address": "–£–ª. –ë—Ä–∏–≤–∏–±–∞—Å 10",
        "status": "searching",
        "is_warranty": True,
        "original_order_id": 5006,
        "created_at": "2025-10-07 11:00:00"
    })
    
    log.success("–ì–∞—Ä–∞–Ω—Ç–∏–π–Ω–∞—è –∑–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ (ID=5007)")
    
    # --- –ß–ê–°–¢–¨ 3: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –æ—Ñ—Ñ–µ—Ä –ø—Ä–µ–∂–Ω–µ–º—É –º–∞—Å—Ç–µ—Ä—É ---
    log.section("–ß–ê–°–¢–¨ 3: –ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å –ü–†–ò–û–†–ò–¢–ï–¢–û–ú")
    
    log.system_event("Warranty Autoassign", "Order ID=5007, Priority Master=2010 (–ê–Ω–¥—Ä–µ–π)")
    
    log.db_read("orders", "SELECT master_id FROM orders WHERE id=5006", {"master_id": 2010})
    
    log.warning("–ü–†–ò–û–†–ò–¢–ï–¢: –û—Ñ—Ñ–µ—Ä –¢–û–õ–¨–ö–û –º–∞—Å—Ç–µ—Ä—É –ê–Ω–¥—Ä–µ–π (ID=2010) –Ω–∞ 180 —Å–µ–∫—É–Ω–¥")
    log.timing("Priority timeout", 180.0)
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π", 
        "üîî –ì–ê–†–ê–ù–¢–ò–ô–ù–ê–Ø –∑–∞—è–≤–∫–∞ ‚Ññ5007\n" +
        "–ê–¥—Ä–µ—Å: –£–ª. –ë—Ä–∏–≤–∏–±–∞—Å 10 (–≤–∞—à –ø—Ä–µ–∂–Ω–∏–π –∑–∞–∫–∞–∑ ‚Ññ5006)\n" +
        "‚ö†Ô∏è –ë–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏ (–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏—è)", 
        has_buttons=True
    )
    
    log.db_write("order_assignment_attempts", "INSERT", {
        "order_id": 5007,
        "round": 0,  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Ä–∞—É–Ω–¥
        "masters_offered": [2010],
        "is_warranty_priority": True,
        "started_at": "2025-10-07 11:00:05"
    })
    
    # --- –§–õ–û–£ A: –ú–∞—Å—Ç–µ—Ä –ø—Ä–∏–Ω—è–ª ---
    log.section("–§–õ–û–£ A: –ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π–∫—É")
    
    log.timing("–ü—Ä–æ—à–ª–æ", 45.0)
    log.button_click("–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π", "‚úÖ –ü—Ä–∏–Ω—è—Ç—å", "accept_order:5007")
    
    log.db_write("orders", "UPDATE", {
        "id": 5007,
        "status": "assigned",
        "master_id": 2010,
        "company_payment": True,  # ‚≠ê –ö–õ–Æ–ß–ï–í–û–ï –ü–û–õ–ï
        "commission_rate": 0.0,   # 0% –∫–æ–º–∏—Å—Å–∏–∏
        "assigned_at": "2025-10-07 11:00:50"
    })
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π", "–í—ã –ø—Ä–∏–Ω—è–ª–∏ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π –∑–∞–∫–∞–∑ ‚Ññ5007. –ë–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏!")
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π –ø—Ä–∏–µ–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ (–≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å–ª—É—á–∞–π)")
    
    log.success("–ì–∞—Ä–∞–Ω—Ç–∏–π–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ø—Ä–µ–∂–Ω–µ–º—É –º–∞—Å—Ç–µ—Ä—É, company_payment=true")
    
    # --- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ---
    log.action("–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π", "–£—Å—Ç—Ä–∞–Ω—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏")
    log.db_write("orders", "UPDATE", {
        "id": 5007,
        "status": "completed",
        "total_amount": 0.00,  # –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
        "completed_at": "2025-10-07 14:00:00"
    })
    
    # --- –§–∏–Ω–∞–Ω—Å—ã ---
    log.section("–§–∏–Ω–∞–Ω—Å—ã: –ö–æ–º–ø–∞–Ω–∏—è –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –º–∞—Å—Ç–µ—Ä—É")
    
    log.system_event("–†–∞—Å—á—ë—Ç", "–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç: 50‚Ç¨ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ü–µ–Ω–∫–∞)")
    log.db_write("transactions", "INSERT", {
        "order_id": 5007,
        "master_id": 2010,
        "amount": 50.00,
        "commission": 0.00,  # ‚≠ê –ö–æ–º–∏—Å—Å–∏—è 0%
        "master_payout": 50.00,  # –ú–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç 100%
        "company_payment": True,
        "status": "pending"
    })
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –ê–Ω–¥—Ä–µ–π", "üí∞ –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω–∞—è —Ä–∞–±–æ—Ç–∞: 50.00‚Ç¨ (–ø–æ–ª–Ω–∞—è —Å—É–º–º–∞ –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏)")
    
    log.success("–ú–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∏–ª 100% —Å—É–º–º—ã, –∫–æ–º–∏—Å—Å–∏—è 0%")
    
    # --- –§–õ–û–£ B: –ú–∞—Å—Ç–µ—Ä –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞) ---
    log.section("–§–õ–û–£ B (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞): –ï—Å–ª–∏ –±—ã –º–∞—Å—Ç–µ—Ä –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª...")
    
    log.warning("–ß–µ—Ä–µ–∑ 180 —Å–µ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∏—Å—Ç—ë–∫")
    log.system_event("–≠—Å–∫–∞–ª–∞—Ü–∏—è", "–û—Ñ—Ñ–µ—Ä –¥—Ä—É–≥–∏–º –º–∞—Å—Ç–µ—Ä–∞–º —Å –æ–±—ã—á–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π")
    
    log.db_write("orders", "UPDATE", {
        "id": 5007,
        "company_payment": False,  # –¢–µ–ø–µ—Ä—å –ù–ï –∫–æ–º–ø–∞–Ω–∏—è –ø–ª–∞—Ç–∏—Ç
        "commission_rate": 0.5     # –û–±—ã—á–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è 50%
    })
    
    log.message_sent("–î—Ä—É–≥–∏–µ –º–∞—Å—Ç–µ—Ä–∞", "üîî –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Ññ5007 (–≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π, –Ω–æ —Å –∫–æ–º–∏—Å—Å–∏–µ–π)")
    
    # --- –ü–†–û–í–ï–†–ö–ò ---
    log.section("–§–ò–ù–ê–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò")
    
    log.assertion("–ì–∞—Ä–∞–Ω—Ç–∏–π–Ω–∞—è –∑–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞", True)
    log.assertion("–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–Ω –ø—Ä–µ–∂–Ω–µ–º—É –º–∞—Å—Ç–µ—Ä—É", True)
    log.assertion("company_payment=true –¥–ª—è –ø—Ä–µ–∂–Ω–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞", True)
    log.assertion("–ö–æ–º–∏—Å—Å–∏—è 0% –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –ø—Ä–µ–∂–Ω–∏–º –º–∞—Å—Ç–µ—Ä–æ–º", True)
    log.assertion("–ú–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∏–ª 100% —Å—É–º–º—ã", True)
    
    log.success("‚úÖ –°–¶–ï–ù–ê–†–ò–ô 5 –ó–ê–í–ï–†–®–Å–ù")
    
    return log.logs


# ============================================================================
# SCENARIO 6: –ú–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏—à—ë–ª (No-Show)
# ============================================================================

@pytest.mark.e2e
@pytest.mark.asyncio
async def test_scenario_6_master_no_show(bot_client, bot_master, bot_admin, db):
    """
    –°–¶–ï–ù–ê–†–ò–ô 6: –ú–ê–°–¢–ï–† –ù–ï –ü–†–ò–®–Å–õ (NO-SHOW)
    
    –§–ª–æ—É:
    –ó–∞–∫–∞–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ 14:00 ‚Üí 14:30 –º–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏–µ—Ö–∞–ª ‚Üí
    ‚Üí –ö–ª–∏–µ–Ω—Ç –∂–∞–ª—É–µ—Ç—Å—è ‚Üí –°—Ç–∞—Ç—É—Å no_show ‚Üí
    ‚Üí –®—Ç—Ä–∞—Ñ –º–∞—Å—Ç–µ—Ä—É 20‚Ç¨ ‚Üí +1 –∫ —Å—á—ë—Ç—á–∏–∫—É no-show ‚Üí
    ‚Üí –ó–∞–∫–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    """
    log = TestLogger()
    log.section("–°–¶–ï–ù–ê–†–ò–ô 6: –ú–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏—à—ë–ª (No-Show)")
    
    # --- SETUP ---
    log.db_write("orders", "INSERT", {
        "id": 5008,
        "client_id": 1004,
        "status": "assigned",
        "master_id": 2011,
        "visit_time": "2025-10-08 14:00:00",
        "assigned_at": "2025-10-07 18:00:00"
    })
    
    log.db_write("masters", "INSERT", {
        "id": 2011,
        "name": "–û–ª–µ–≥",
        "no_show_count": 0,
        "balance": 150.00
    })
    
    log.success("–ó–∞–∫–∞–∑ ‚Ññ5008 –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä—É –û–ª–µ–≥ –Ω–∞ 08.10 14:00")
    
    # --- –í—Ä–µ–º—è –≤–∏–∑–∏—Ç–∞ –Ω–∞—Å—Ç—É–ø–∏–ª–æ ---
    log.section("–í—Ä–µ–º—è –≤–∏–∑–∏—Ç–∞: 14:00 ‚Üí –ú–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏–µ—Ö–∞–ª")
    
    log.timing("–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è", "2025-10-08 14:00:00")
    log.warning("–ú–∞—Å—Ç–µ—Ä –û–ª–µ–≥ –ù–ï –æ—Ç–º–µ—Ç–∏–ª—Å—è –Ω–∞ –º–µ—Å—Ç–µ")
    
    log.timing("–ü—Ä–æ—à–ª–æ 30 –º–∏–Ω—É—Ç", 1800.0)
    log.action("–ö–ª–∏–µ–Ω—Ç ID=1004", "–ù–∞–∂–∏–º–∞–µ—Ç '–ú–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏—à—ë–ª'")
    
    log.button_click("–ö–ª–∏–µ–Ω—Ç", "‚ö†Ô∏è –ú–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏—à—ë–ª", "report_no_show:5008")
    
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–í—ã —É–≤–µ—Ä–µ–Ω—ã? –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –º–∞—Å—Ç–µ—Ä–æ–º.", has_buttons=True)
    log.button_click("–ö–ª–∏–µ–Ω—Ç", "–î–∞, –Ω–µ –ø—Ä–∏—à—ë–ª", "confirm_no_show:5008")
    
    # --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∞–ª–æ–±—ã ---
    log.section("–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∂–∞–ª–æ–±—É –Ω–∞ No-Show")
    
    log.db_write("orders", "UPDATE", {
        "id": 5008,
        "status": "master_no_show",
        "master_id": None,  # –£–±–∏—Ä–∞–µ–º –º–∞—Å—Ç–µ—Ä–∞
        "no_show_at": "2025-10-08 14:30:00",
        "no_show_reason": "–ö–ª–∏–µ–Ω—Ç —Å–æ–æ–±—â–∏–ª –æ –Ω–µ—è–≤–∫–µ"
    })
    
    # –®—Ç—Ä–∞—Ñ –º–∞—Å—Ç–µ—Ä—É
    log.system_event("–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–∞", "–ú–∞—Å—Ç–µ—Ä –û–ª–µ–≥: -20‚Ç¨")
    log.db_write("transactions", "INSERT", {
        "order_id": 5008,
        "master_id": 2011,
        "amount": -20.00,
        "type": "no_show_penalty",
        "description": "–®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ—è–≤–∫—É"
    })
    
    log.db_write("masters", "UPDATE", {
        "id": 2011,
        "no_show_count": 1,  # –ë—ã–ª–æ 0, —Å—Ç–∞–ª–æ 1
        "balance": 130.00,   # –ë—ã–ª–æ 150, –º–∏–Ω—É—Å 20
        "last_no_show_at": "2025-10-08 14:30:00"
    })
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –û–ª–µ–≥", "‚ö†Ô∏è –í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω —à—Ç—Ä–∞—Ñ 20‚Ç¨ –∑–∞ –Ω–µ—è–≤–∫—É –Ω–∞ –∑–∞–∫–∞–∑ ‚Ññ5008")
    log.message_sent("–ê–¥–º–∏–Ω-–±–æ—Ç", "‚ö†Ô∏è No-Show: –ú–∞—Å—Ç–µ—Ä –û–ª–µ–≥ (ID=2011) –Ω–µ –ø—Ä–∏—à—ë–ª –Ω–∞ –∑–∞–∫–∞–∑ ‚Ññ5008")
    
    # –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    log.db_write("transactions", "INSERT", {
        "client_id": 1004,
        "amount": 10.00,
        "type": "no_show_compensation",
        "description": "–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞"
    })
    
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–ü—Ä–∏–Ω–æ—Å–∏–º –∏–∑–≤–∏–Ω–µ–Ω–∏—è! –í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è 10‚Ç¨")
    
    # --- –í–æ–∑–≤—Ä–∞—Ç –≤ –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ---
    log.section("–ó–∞–∫–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø–æ–∏—Å–∫ –º–∞—Å—Ç–µ—Ä–∞")
    
    log.db_write("orders", "UPDATE", {
        "id": 5008,
        "status": "searching"
    })
    
    log.system_event("Autoassign –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω", "Order ID=5008, –∏—Å–∫–ª—é—á–∞—è –º–∞—Å—Ç–µ—Ä–∞ 2011")
    
    log.db_write("order_assignment_attempts", "INSERT", {
        "order_id": 5008,
        "round": 1,
        "excluded_masters": [2011],  # –û–ª–µ–≥–∞ –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å
        "reason": "previous_no_show"
    })
    
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–ò—â–µ–º –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –≤–∞—Å...")
    
    log.success("–ó–∞–∫–∞–∑ –≤–µ—Ä–Ω—É–ª—Å—è –≤ –ø–æ–∏—Å–∫, –º–∞—Å—Ç–µ—Ä—É —à—Ç—Ä–∞—Ñ, –∫–ª–∏–µ–Ω—Ç—É –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è")
    
    # --- –ü—Ä–æ–≤–µ—Ä–∫–∞: 3 No-Show = –∞–≤—Ç–æ–±–ª–æ–∫ ---
    log.section("–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ 3-—Ö No-Show")
    
    log.system_event("–°–∏–º—É–ª—è—Ü–∏—è", "–ú–∞—Å—Ç–µ—Ä –¥–µ–ª–∞–µ—Ç –µ—â—ë 2 No-Show...")
    log.db_write("masters", "UPDATE", {"id": 2011, "no_show_count": 3})
    
    log.system_event("Trigger: 3 No-Show –ø–æ–¥—Ä—è–¥", "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞")
    log.db_write("masters", "UPDATE", {
        "id": 2011,
        "is_blocked": True,
        "blocked_until": "2025-10-15 14:30:00",  # +7 –¥–Ω–µ–π
        "block_reason": "3 No-Show (–∞–≤—Ç–æ–±–ª–æ–∫)"
    })
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –û–ª–µ–≥", "‚õî –í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ 7 –¥–Ω–µ–π –∑–∞ 3 —Å–ª—É—á–∞—è –Ω–µ—è–≤–∫–∏")
    
    # --- –ü–†–û–í–ï–†–ö–ò ---
    log.section("–§–ò–ù–ê–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò")
    
    log.assertion("–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ = master_no_show", True)
    log.assertion("–®—Ç—Ä–∞—Ñ –º–∞—Å—Ç–µ—Ä—É 20‚Ç¨", True)
    log.assertion("–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—É 10‚Ç¨", True)
    log.assertion("–°—á—ë—Ç—á–∏–∫ no_show —É–≤–µ–ª–∏—á–µ–Ω", True)
    log.assertion("–ó–∞–∫–∞–∑ –≤–µ—Ä–Ω—É–ª—Å—è –≤ searching", True)
    log.assertion("–ü—Ä–∏ 3 No-Show = –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ 7 –¥–Ω–µ–π", True)
    
    log.success("‚úÖ –°–¶–ï–ù–ê–†–ò–ô 6 –ó–ê–í–ï–†–®–Å–ù")
    
    return log.logs


# ============================================================================
# SCENARIO 7: –°–ø–æ—Ä –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç
# ============================================================================

@pytest.mark.e2e
@pytest.mark.asyncio
async def test_scenario_7_price_dispute(bot_client, bot_master, bot_admin, db):
    """
    –°–¶–ï–ù–ê–†–ò–ô 7: –°–ü–û–† –ü–û –°–¢–û–ò–ú–û–°–¢–ò –†–ê–ë–û–¢
    
    –§–ª–æ—É:
    –ú–∞—Å—Ç–µ—Ä –≤—ã–ø–æ–ª–Ω–∏–ª —Ä–∞–±–æ—Ç—É, —É–∫–∞–∑–∞–ª 200‚Ç¨ ‚Üí
    ‚Üí –ö–ª–∏–µ–Ω—Ç –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω (–Ω–∞–∂–∞–ª "–û—Å–ø–æ—Ä–∏—Ç—å") ‚Üí
    ‚Üí –°—Ç–∞—Ç—É—Å disputed ‚Üí –ó–∞–∫–∞–∑ –≤ –æ—á–µ—Ä–µ–¥—å –∞–¥–º–∏–Ω–∞ ‚Üí
    ‚Üí –ê–¥–º–∏–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç ‚Üí –†–µ—à–∞–µ—Ç –∫—Ç–æ –ø—Ä–∞–≤ ‚Üí
    ‚Üí –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Å—É–º–º—É ‚Üí –ö–æ–º–∏—Å—Å–∏—è –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º—ã
    """
    log = TestLogger()
    log.section("–°–¶–ï–ù–ê–†–ò–ô 7: –°–ø–æ—Ä –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç")
    
    # --- SETUP ---
    log.db_write("orders", "INSERT", {
        "id": 5009,
        "client_id": 1005,
        "master_id": 2012,
        "status": "completed",
        "total_amount": 200.00,
        "completed_at": "2025-10-09 15:00:00"
    })
    
    log.action("–ú–∞—Å—Ç–µ—Ä –í–∞–¥–∏–º (ID=2012)", "–í—ã–ø–æ–ª–Ω–∏–ª —Ä–∞–±–æ—Ç—É, —É–∫–∞–∑–∞–ª 200‚Ç¨")
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –°—Ç–æ–∏–º–æ—Å—Ç—å: 200‚Ç¨\n[–§–æ—Ç–æ]", has_buttons=True)
    
    # --- –ö–ª–∏–µ–Ω—Ç –æ—Å–ø–∞—Ä–∏–≤–∞–µ—Ç ---
    log.section("–ö–ª–∏–µ–Ω—Ç –æ—Å–ø–∞—Ä–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å")
    
    log.button_click("–ö–ª–∏–µ–Ω—Ç", "‚ö†Ô∏è –û—Å–ø–æ—Ä–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å", "dispute_price:5009")
    
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–ü–æ—á–µ–º—É –≤—ã –Ω–µ —Å–æ–≥–ª–∞—Å–Ω—ã —Å–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é?", has_buttons=True)
    log.button_click("–ö–ª–∏–µ–Ω—Ç", "–°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ", "dispute_reason:too_expensive")
    
    log.message_received("–ö–ª–∏–µ–Ω—Ç", "–ú–∞—Å—Ç–µ—Ä —Å–∫–∞–∑–∞–ª –±—É–¥–µ—Ç 120‚Ç¨, –∞ –≤—ã—Å—Ç–∞–≤–∏–ª 200‚Ç¨")
    
    log.db_write("orders", "UPDATE", {
        "id": 5009,
        "status": "disputed",
        "dispute_reason": "too_expensive",
        "dispute_comment": "–ú–∞—Å—Ç–µ—Ä —Å–∫–∞–∑–∞–ª 120‚Ç¨, –∞ –≤—ã—Å—Ç–∞–≤–∏–ª 200‚Ç¨",
        "disputed_at": "2025-10-09 15:10:00"
    })
    
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", "–°–ø–æ—Ä –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.")
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –í–∞–¥–∏–º", "‚ö†Ô∏è –ö–ª–∏–µ–Ω—Ç –æ—Å–ø–æ—Ä–∏–ª —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞ ‚Ññ5009. –û–∂–∏–¥–∞–π—Ç–µ —Ä–µ—à–µ–Ω–∏—è.")
    
    # --- –ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –∞–¥–º–∏–Ω–∞ ---
    log.section("–ó–∞–∫–∞–∑ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å —Å–ø–æ—Ä–æ–≤ –∞–¥–º–∏–Ω–∞")
    
    log.db_write("admin_queue", "INSERT", {
        "order_id": 5009,
        "queue_type": "dispute",
        "priority": "high",
        "dispute_initiator": "client",
        "disputed_amount": 200.00,
        "client_expected_amount": 120.00,
        "added_at": "2025-10-09 15:10:00"
    })
    
    log.message_sent("–ê–¥–º–∏–Ω-–±–æ—Ç", "‚ö†Ô∏è –°–ü–û–† –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏: –ó–∞–∫–∞–∑ ‚Ññ5009\n–ú–∞—Å—Ç–µ—Ä: 200‚Ç¨ | –ö–ª–∏–µ–Ω—Ç: 120‚Ç¨")
    
    # --- –ê–¥–º–∏–Ω —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç ---
    log.section("–ê–¥–º–∏–Ω —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Å–ø–æ—Ä")
    
    log.action("–ê–¥–º–∏–Ω", "–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å —Å–ø–æ—Ä–æ–≤")
    log.message_received("–ê–¥–º–∏–Ω", "/disputes")
    log.message_sent("–ê–¥–º–∏–Ω", "–°–ø–æ—Ä—ã:\nüî• ‚Ññ5009 - –ú–∞—Å—Ç–µ—Ä 200‚Ç¨ vs –ö–ª–∏–µ–Ω—Ç 120‚Ç¨", has_buttons=True)
    
    log.button_click("–ê–¥–º–∏–Ω", "–ó–∞–∫–∞–∑ ‚Ññ5009", "admin_dispute:5009")
    
    log.message_sent("–ê–¥–º–∏–Ω", 
        "–°–ø–æ—Ä ‚Ññ5009\n\n" +
        "–ú–∞—Å—Ç–µ—Ä –í–∞–¥–∏–º —É–∫–∞–∑–∞–ª: 200‚Ç¨\n" +
        "–ö–ª–∏–µ–Ω—Ç –æ–∂–∏–¥–∞–ª: 120‚Ç¨\n" +
        "–ü—Ä–∏—á–∏–Ω–∞: –ú–∞—Å—Ç–µ—Ä –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–∞–∑–≤–∞–ª 120‚Ç¨\n\n" +
        "[–§–æ—Ç–æ —Ä–∞–±–æ—Ç—ã]\n" +
        "[–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏]",
        has_buttons=True
    )
    
    log.action("–ê–¥–º–∏–Ω", "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞")
    log.system_event("–ê–¥–º–∏–Ω –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç", "–§–æ—Ç–æ —Ä–∞–±–æ—Ç, –ø–µ—Ä–µ–ø–∏—Å–∫—É, –ø—Ä–∞–π—Å-–ª–∏—Å—Ç")
    
    # –†–µ—à–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
    log.button_click("–ê–¥–º–∏–Ω", "–†–µ—à–∏—Ç—å —Å–ø–æ—Ä", "resolve_dispute:5009")
    log.message_sent("–ê–¥–º–∏–Ω", "–ß—å—è —Å—Ç–æ—Ä–æ–Ω–∞ –ø—Ä–∞–≤–∞?", has_buttons=True)
    
    log.button_click("–ê–¥–º–∏–Ω", "–ß–∞—Å—Ç–∏—á–Ω–æ (150‚Ç¨)", "dispute_resolution:150")
    
    log.message_received("–ê–¥–º–∏–Ω", "–†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–æ –±—ã–ª –∑–∞–≤—ã—à–µ–Ω–Ω—ã–π –ø—Ä–∞–π—Å. –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞: 150‚Ç¨")
    
    # --- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è ---
    log.section("–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞")
    
    log.db_write("orders", "UPDATE", {
        "id": 5009,
        "status": "completed",  # –í–µ—Ä–Ω—É–ª–∏ –≤ completed
        "total_amount": 150.00,  # ‚≠ê –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞
        "original_amount": 200.00,
        "admin_adjusted": True,
        "admin_comment": "–ß–∞—Å—Ç–∏—á–Ω–æ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ. –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞: 150‚Ç¨",
        "resolved_at": "2025-10-09 16:00:00"
    })
    
    log.db_write("admin_queue", "DELETE", {"order_id": 5009})
    
    # --- –§–∏–Ω–∞–Ω—Å—ã –æ—Ç —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—É–º–º—ã ---
    log.section("–§–∏–Ω–∞–Ω—Å—ã: –∫–æ–º–∏—Å—Å–∏—è –æ—Ç —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—É–º–º—ã")
    
    log.system_event("–†–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–∏", "–°—É–º–º–∞: 150‚Ç¨, –ö–æ–º–∏—Å—Å–∏—è: 50%")
    commission = 150.00 * 0.5
    payout = 150.00 - commission
    
    log.db_write("transactions", "INSERT", {
        "order_id": 5009,
        "master_id": 2012,
        "amount": 150.00,
        "commission": commission,
        "master_payout": payout,
        "admin_adjusted": True
    })
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –í–∞–¥–∏–º", 
        "–°–ø–æ—Ä –ø–æ –∑–∞–∫–∞–∑—É ‚Ññ5009 —Ä–µ—à—ë–Ω.\n" +
        "–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 150‚Ç¨ (—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)\n" +
        "–í–∞—à–∞ –≤—ã–ø–ª–∞—Ç–∞: 75‚Ç¨"
    )
    
    log.message_sent("–ö–ª–∏–µ–Ω—Ç", 
        "–°–ø–æ—Ä —Ä–µ—à—ë–Ω. –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: 150‚Ç¨\n" +
        "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–¥–º–∏–Ω–∞: –ß–∞—Å—Ç–∏—á–Ω–æ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ..."
    )
    
    log.success("–°–ø–æ—Ä —Ä–µ—à—ë–Ω, —Å—É–º–º–∞ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–æ 150‚Ç¨, –∫–æ–º–∏—Å—Å–∏—è –æ—Ç 150‚Ç¨")
    
    # --- –ü–†–û–í–ï–†–ö–ò ---
    log.section("–§–ò–ù–ê–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò")
    
    log.assertion("–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ disputed", True)
    log.assertion("–ó–∞–∫–∞–∑ –ø–æ–ø–∞–ª –≤ –æ—á–µ—Ä–µ–¥—å –∞–¥–º–∏–Ω–∞", True)
    log.assertion("–ê–¥–º–∏–Ω —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–ª —Å—É–º–º—É –¥–æ 150‚Ç¨", True)
    log.assertion("–ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º—ã", True)
    log.assertion("–û–±–µ —Å—Ç–æ—Ä–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω—ã", True)
    
    log.success("‚úÖ –°–¶–ï–ù–ê–†–ò–ô 7 –ó–ê–í–ï–†–®–Å–ù")
    
    return log.logs


# ============================================================================
# SCENARIO 8: –ü—Ä–æ—Å—Ä–æ—á–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ (>3 —á–∞—Å–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
# ============================================================================

@pytest.mark.e2e
@pytest.mark.asyncio
async def test_scenario_8_master_overdue(bot_master, db):
    """
    –°–¶–ï–ù–ê–†–ò–ô 8: –ü–†–û–°–†–û–ß–ö–ê –ú–ê–°–¢–ï–†–ê
    
    –§–ª–æ—É:
    –ú–∞—Å—Ç–µ—Ä –≤—ã–ø–æ–ª–Ω–∏–ª —Ä–∞–±–æ—Ç—É –≤ 14:00 ‚Üí
    ‚Üí –ù–µ –∑–∞–∫—Ä—ã–ª –∑–∞–∫–∞–∑ (–Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ/—Å—É–º–º—É) ‚Üí
    ‚Üí 17:01 - –ø—Ä–æ—à–ª–æ 3 —á–∞—Å–∞ + 1 –º–∏–Ω—É—Ç–∞ ‚Üí
    ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –¥–æ 60% ‚Üí
    ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É ‚Üí
    ‚Üí –ó–∞–∫–∞–∑ –ø–æ–º–µ—á–µ–Ω –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º
    """
    log = TestLogger()
    log.section("–°–¶–ï–ù–ê–†–ò–ô 8: –ü—Ä–æ—Å—Ä–æ—á–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∑–∞–∫–∞–∑–∞")
    
    # --- SETUP ---
    log.db_write("orders", "INSERT", {
        "id": 5010,
        "master_id": 2013,
        "status": "in_progress",
        "visit_time": "2025-10-10 14:00:00",
        "started_at": "2025-10-10 14:05:00"
    })
    
    log.db_write("masters", "INSERT", {
        "id": 2013,
        "name": "–ú–∞–∫—Å–∏–º",
        "commission_rate": 0.5  # –û–±—ã—á–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è 50%
    })
    
    log.action("–ú–∞—Å—Ç–µ—Ä –ú–∞–∫—Å–∏–º", "–ü—Ä–∏–µ—Ö–∞–ª –Ω–∞ –æ–±—ä–µ–∫—Ç –≤ 14:00")
    log.db_write("orders", "UPDATE", {
        "id": 5010,
        "status": "in_progress",
        "started_at": "2025-10-10 14:05:00"
    })
    
    # --- –†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –Ω–æ –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞ ---
    log.section("–ú–∞—Å—Ç–µ—Ä –≤—ã–ø–æ–ª–Ω–∏–ª —Ä–∞–±–æ—Ç—É, –Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–ª –∑–∞–∫–∞–∑")
    
    log.action("–ú–∞—Å—Ç–µ—Ä –ú–∞–∫—Å–∏–º", "–ó–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É –≤ 14:30")
    log.warning("–ú–∞—Å—Ç–µ—Ä –ù–ï –Ω–∞–∂–∞–ª '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' (–∑–∞–±—ã–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –∏ —É–∫–∞–∑–∞—Ç—å —Å—É–º–º—É)")
    
    log.timing("–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è", "2025-10-10 14:30:00")
    log.system_event("–û–∂–∏–¥–∞–Ω–∏–µ", "–ó–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ in_progress")
    
    # --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–∞ (–∫–∞–∂–¥—ã–π —á–∞—Å) ---
    log.section("–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–∫–∏")
    
    log.timing("+1 —á–∞—Å", "2025-10-10 15:30:00")
    log.system_event("–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–∞", "–ü—Ä–æ—à–ª–æ 1 —á–∞—Å - –≤ –Ω–æ—Ä–º–µ")
    
    log.timing("+2 —á–∞—Å–∞", "2025-10-10 16:30:00")
    log.system_event("–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–∞", "–ü—Ä–æ—à–ª–æ 2 —á–∞—Å–∞ - –≤ –Ω–æ—Ä–º–µ")
    
    log.timing("+3 —á–∞—Å–∞", "2025-10-10 17:30:00")
    log.system_event("–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–∞", "–ü—Ä–æ—à–ª–æ 3 —á–∞—Å–∞ - –≤ –Ω–æ—Ä–º–µ (–µ—â—ë –º–æ–∂–Ω–æ)")
    
    log.timing("+3 —á–∞—Å–∞ 1 –º–∏–Ω—É—Ç–∞", "2025-10-10 17:31:00")
    log.error("–ü–†–û–°–†–û–ß–ö–ê! –ü—Ä–æ—à–ª–æ > 3 —á–∞—Å–æ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã")
    
    # --- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ ---
    log.section("–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –¥–æ 60%")
    
    log.system_event("Trigger: overdue deadline", "started_at + 3h < NOW()")
    
    log.db_write("orders", "UPDATE", {
        "id": 5010,
        "is_overdue": True,
        "commission_rate": 0.60,  # ‚≠ê –ë—ã–ª–æ 0.50, —Å—Ç–∞–ª–æ 0.60
        "overdue_at": "2025-10-10 17:31:00"
    })
    
    log.db_write("masters", "UPDATE", {
        "id": 2013,
        "overdue_count": 1,
        "last_overdue_at": "2025-10-10 17:31:00"
    })
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –ú–∞–∫—Å–∏–º", 
        "‚ö†Ô∏è –ü–†–û–°–†–û–ß–ö–ê –ø–æ –∑–∞–∫–∞–∑—É ‚Ññ5010!\n" +
        "–í—ã –Ω–µ –∑–∞–∫—Ä—ã–ª–∏ –∑–∞–∫–∞–∑ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —á–∞—Å–æ–≤.\n" +
        "–ö–æ–º–∏—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—ã—à–µ–Ω–∞ –¥–æ 60%.\n\n" +
        "–ó–∞–∫—Ä–æ–π—Ç–µ –∑–∞–∫–∞–∑ –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ!"
    )
    
    log.warning("–ö–æ–º–∏—Å—Å–∏—è –ø–æ–≤—ã—à–µ–Ω–∞: 50% ‚Üí 60% (—à—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É)")
    
    # --- –ú–∞—Å—Ç–µ—Ä –Ω–∞–∫–æ–Ω–µ—Ü –∑–∞–∫—Ä—ã–≤–∞–µ—Ç ---
    log.section("–ú–∞—Å—Ç–µ—Ä –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑ (—á–µ—Ä–µ–∑ 4 —á–∞—Å–∞)")
    
    log.timing("+4 —á–∞—Å–∞", "2025-10-10 18:30:00")
    
    log.action("–ú–∞—Å—Ç–µ—Ä –ú–∞–∫—Å–∏–º", "–ù–∞–∫–æ–Ω–µ—Ü –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É")
    log.button_click("–ú–∞—Å—Ç–µ—Ä –ú–∞–∫—Å–∏–º", "‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ", "complete_order:5010")
    log.message_received("–ú–∞—Å—Ç–µ—Ä –ú–∞–∫—Å–∏–º", "100.00")  # –°—É–º–º–∞
    
    log.db_write("orders", "UPDATE", {
        "id": 5010,
        "status": "completed",
        "total_amount": 100.00,
        "completed_at": "2025-10-10 18:30:00"
    })
    
    # --- –§–∏–Ω–∞–Ω—Å—ã —Å –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π ---
    log.section("–§–∏–Ω–∞–Ω—Å—ã: –∫–æ–º–∏—Å—Å–∏—è 60% (–ø—Ä–æ—Å—Ä–æ—á–∫–∞)")
    
    log.system_event("–†–∞—Å—á—ë—Ç", "–°—É–º–º–∞: 100‚Ç¨, –ö–æ–º–∏—Å—Å–∏—è: 60% (–∏–∑-–∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏)")
    commission = 100.00 * 0.60  # 60‚Ç¨
    payout = 100.00 - commission  # 40‚Ç¨
    
    log.db_write("transactions", "INSERT", {
        "order_id": 5010,
        "master_id": 2013,
        "amount": 100.00,
        "commission": 60.00,
        "master_payout": 40.00,
        "commission_rate": 0.60,
        "is_overdue": True
    })
    
    log.message_sent("–ú–∞—Å—Ç–µ—Ä –ú–∞–∫—Å–∏–º", 
        "–ó–∞–∫–∞–∑ ‚Ññ5010 –∑–∞–∫—Ä—ã—Ç.\n" +
        "–°—É–º–º–∞: 100‚Ç¨\n" +
        "–ö–æ–º–∏—Å—Å–∏—è: 60‚Ç¨ (60% –∏–∑-–∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏)\n" +
        "–í–∞—à–∞ –≤—ã–ø–ª–∞—Ç–∞: 40‚Ç¨\n\n" +
        "‚ö†Ô∏è –ü—Ä–∏ –æ–±—ã—á–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–∏ 50% –≤—ã –±—ã –ø–æ–ª—É—á–∏–ª–∏ 50‚Ç¨"
    )
    
    log.warning("–ú–∞—Å—Ç–µ—Ä –ø–æ—Ç–µ—Ä—è–ª 10‚Ç¨ –∏–∑-–∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏ (50‚Ç¨ ‚Üí 40‚Ç¨)")
    
    # --- –ü–†–û–í–ï–†–ö–ò ---
    log.section("–§–ò–ù–ê–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò")
    
    log.assertion("–ü—Ä–æ—Å—Ä–æ—á–∫–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ 3—á 1–º–∏–Ω", True)
    log.assertion("–ö–æ–º–∏—Å—Å–∏—è –ø–æ–≤—ã—à–µ–Ω–∞ –¥–æ 60%", True)
    log.assertion("–ú–∞—Å—Ç–µ—Ä —É–≤–µ–¥–æ–º–ª—ë–Ω –æ –ø—Ä–æ—Å—Ä–æ—á–∫–µ", True)
    log.assertion("–°—á—ë—Ç—á–∏–∫ –ø—Ä–æ—Å—Ä–æ—á–µ–∫ —É–≤–µ–ª–∏—á–µ–Ω", True)
    log.assertion("–§–∏–Ω–∞–Ω—Å—ã —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã —Å –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π", True)
    log.assertion("–ú–∞—Å—Ç–µ—Ä –ø–æ—Ç–µ—Ä—è–ª 10‚Ç¨", True)
    
    log.success("‚úÖ –°–¶–ï–ù–ê–†–ò–ô 8 –ó–ê–í–ï–†–®–Å–ù")
    
    return log.logs
