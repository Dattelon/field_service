# üöÄ QUICKSTART: DEFERRED Distribution Bugfix

## üìã –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–ö–Ω–æ–ø–∫–∞ "–¢–µ–ª–µ—Ñ–æ–Ω –º–∞—Å—Ç–µ—Ä–∞"** - —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω
2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ DEFERRED** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –≤ SEARCHING –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
3. **–ë–∏—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–µ–∫—Å—Ç –º–µ–Ω—é "–ó–∞—è–≤–∫–∏"

## üîß –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `field_service/bots/admin_bot/ui/keyboards/orders.py`
- `field_service/bots/admin_bot/handlers/orders/queue.py`
- `field_service/bots/admin_bot/services/distribution.py`

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
docker-compose restart admin-bot
```

### 2. –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–¢–µ–ª–µ—Ñ–æ–Ω –º–∞—Å—Ç–µ—Ä–∞"
1. –û—Ç–∫—Ä—ã—Ç—å –∑–∞–∫–∞–∑ #2 (–ë–ï–ó –º–∞—Å—Ç–µ—Ä–∞)
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 2 –∫–Ω–æ–ø–∫–∏: "–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞", "–ê–¥—Ä–µ—Å"

### 3. –¢–µ—Å—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è DEFERRED
1. –ó–∞–∫–∞–∑ #2 –≤ —Å—Ç–∞—Ç—É—Å–µ DEFERRED
2. –ú–µ–Ω—é ‚Üí –ó–∞—è–≤–∫–∏ ‚Üí –û—á–µ—Ä–µ–¥—å ‚Üí #2
3. –ù–∞–∂–∞—Ç—å "–ù–∞–∑–Ω–∞—á–∏—Ç—å" ‚Üí "–ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"
   - –ü–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚ö†Ô∏è
4. –ù–∞–∂–∞—Ç—å "–î–∞, –∑–∞–ø—É—Å—Ç–∏—Ç—å"
   - –ó–∞–∫–∞–∑ –ø–µ—Ä–µ–π–¥–µ—Ç –≤ SEARCHING
   - –û—Ñ—Ñ–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –º–∞—Å—Ç–µ—Ä—É

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
SELECT id, status FROM orders WHERE id = 2;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
SELECT 
    from_status, 
    to_status, 
    reason, 
    changed_at 
FROM order_status_history 
WHERE order_id = 2 
ORDER BY changed_at DESC 
LIMIT 3;
```

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: `SEARCHING`
- –ò—Å—Ç–æ—Ä–∏—è: `DEFERRED ‚Üí SEARCHING` —Å –ø—Ä–∏—á–∏–Ω–æ–π "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫..."
- –û—Ñ—Ñ–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –º–∞—Å—Ç–µ—Ä—É
- –ú–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

## üìä –õ–æ–≥–∏

```bash
docker-compose logs -f admin-bot | grep "order=2"
```

–ò—â–∏—Ç–µ:
```
[dist] order=2 DEFERRED‚ÜíSEARCHING (forced by staff #...)
[dist] order=2 ... offer sent to master #...
```

---

**–í—Å—ë –≥–æ—Ç–æ–≤–æ!** –ü–∞—Ç—á –ø—Ä–∏–º–µ–Ω—ë–Ω, –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å üéâ
