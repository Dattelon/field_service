# üöÄ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï HOTFIX v1.2.1

## –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### ‚úÖ –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å GLOBAL_ADMIN (id=5)

**–°—Ç–∞—Ç—É—Å:** –ó–∞–ø–∏—Å—å –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å —Å 'ADMIN' –Ω–∞ 'GLOBAL_ADMIN'

### 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
```powershell
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ field-service
Get-Content scripts/update_global_admin.sql | docker exec -i field-service-postgres-1 psql -U fs_user -d field_service
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ psql –Ω–∞–ø—Ä—è–º—É—é:**
```bash
psql -h 127.0.0.1 -p 5439 -U fs_user -d field_service -f scripts/update_global_admin.sql
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```
 staff_id | tg_user_id  | full_name  |     role     
----------+-------------+------------+---------------
    5     | 332786197   | Superuser  | GLOBAL_ADMIN
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–¥–º–∏–Ω-–±–æ—Ç
```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
python -m field_service.bots.admin_bot.main
```

### 4. –¢–µ—Å—Ç
1. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç ‚Üí üí∞ –§–∏–Ω–∞–Ω—Å—ã ‚Üí –û–∂–∏–¥–∞—é—Ç –æ–ø–ª–∞—Ç—ã
2. –í—ã–±—Ä–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é ‚Üí ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ **–ù–ï–¢ –æ—à–∏–±–∫–∏ FK-constraint**

---

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –í–∞–ª–∏–¥–∞—Ü–∏—è staff.id
‚ùå **–ë—ã–ª–æ:** `if staff.id <= 0` –æ—Ç–∫–ª–æ–Ω—è–ª–æ GLOBAL_ADMIN  
‚úÖ **–°—Ç–∞–ª–æ:** `if staff.id < 0` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ª—é–±—ã–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ id

### –ü—Ä–æ–±–ª–µ–º–∞ #2: FK-constraint
‚ùå **–ë—ã–ª–æ:** middleware —Å–æ–∑–¥–∞–≤–∞–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å id=0  
‚úÖ **–°—Ç–∞–ª–æ:** –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –∏–∑ –ë–î (id=5)

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –†–æ–ª—å 'ADMIN' –≤–º–µ—Å—Ç–æ 'GLOBAL_ADMIN'
‚ùå **–ë—ã–ª–æ:** role = 'ADMIN' (legacy –∑–Ω–∞—á–µ–Ω–∏–µ)  
‚úÖ **–°—Ç–∞–ª–æ:** role = 'GLOBAL_ADMIN' (–∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `handlers_finance.py` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è (3 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞)
- `middlewares.py` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ superuser –∏–∑ –ë–î
- `scripts/update_global_admin.sql` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ (–ù–û–í–´–ô)
- `CHANGELOG.md` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω

---

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ
–î–∞—Ç–∞: 03.10.2025, 22:30

**–ì–ª–∞–≤–Ω–æ–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç `update_global_admin.sql` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç!
