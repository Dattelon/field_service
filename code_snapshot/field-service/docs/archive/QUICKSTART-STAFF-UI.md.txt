# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ù–æ–≤—ã–π UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ç—á (1 –º–∏–Ω—É—Ç–∞)

**–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª:** `field_service/bots/admin_bot/services_db.py`

**–ù–∞–π—Ç–∏ –º–µ—Ç–æ–¥** `register_staff_user_from_code` (–ø—Ä–∏–º–µ—Ä–Ω–æ —Å—Ç—Ä–æ–∫–∞ 2750-2850)

**–ü–æ—Å–ª–µ –µ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ `return StaffUser(...)` –≤—Å—Ç–∞–≤–∏—Ç—å:**

```python
async def add_staff_direct(
    self,
    *,
    tg_id: Optional[int],
    username: Optional[str],
    role: StaffRole,
    city_ids: Iterable[int],
    created_by_staff_id: int,
) -> StaffUser:
    """–ù–∞–ø—Ä—è–º—É—é –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –±–µ–∑ access code."""
    if not tg_id and not username:
        raise ValueError("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å tg_id –∏–ª–∏ username")
    
    now = datetime.now(UTC)
    unique_cities = _sorted_city_tuple(city_ids)
    
    async with self._session_factory() as session:
        async with session.begin():
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
            if tg_id:
                existing = await session.execute(
                    select(m.staff_users).where(m.staff_users.tg_user_id == tg_id)
                )
                if existing.scalar_one_or_none():
                    raise AccessCodeError("already_staff")
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            staff_row = m.staff_users(
                tg_user_id=tg_id,
                username=username,
                full_name=username or f"User{tg_id}" if tg_id else "Unknown",
                phone="",
                role=_map_staff_role_to_db(role),
                is_active=True,
            )
            session.add(staff_row)
            await session.flush()
            
            # –ü—Ä–∏–≤—è–∑–∫–∞ –≥–æ—Ä–æ–¥–æ–≤
            if unique_cities:
                session.add_all(
                    m.staff_cities(staff_user_id=staff_row.id, city_id=cid)
                    for cid in unique_cities
                )
            
            cities_label = ", ".join(str(cid) for cid in unique_cities) or "all"
            live_log.push(
                "staff",
                f"staff added direct: id={staff_row.id} tg_id={tg_id} "
                f"username={username} role={role.value} cities={cities_label} "
                f"by={created_by_staff_id}"
            )
    
    return StaffUser(
        id=staff_row.id,
        tg_id=tg_id or 0,
        role=role,
        is_active=True,
        city_ids=frozenset(unique_cities),
        full_name=staff_row.full_name or "",
        phone=staff_row.phone or "",
    )
```

### 2Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
# Ctrl+C (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)
python -m field_service.bots.admin_bot
```

### 3Ô∏è‚É£ –ì–æ—Ç–æ–≤–æ! üéâ

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–±–æ—Ç
2. –ù–∞–∂–º–∏—Ç–µ **"üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª –∏ –¥–æ—Å—Ç—É–ø"** (—Ç–æ–ª—å–∫–æ –¥–ª—è Global Admin)
3. –ù–∞–∂–º–∏—Ç–µ **"‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª"**
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:
   - üëë Global Admin (–≤–µ—Å—å –¥–æ—Å—Ç—É–ø)
   - üèõ City Admin (–≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–æ–≤)
   - üì¶ Logist (–≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–æ–≤)
5. –í–≤–µ–¥–∏—Ç–µ **Telegram ID** –∏–ª–∏ **@username** —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
6. –ï—Å–ª–∏ –Ω–µ Global Admin ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ **–≥–æ—Ä–æ–¥–∞**
7. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ ‚Üí **–ì–æ—Ç–æ–≤–æ!** ‚úÖ

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å Telegram ID?

**–ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:**
1. –ù–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É `@userinfobot`
2. –ò–ª–∏ `@getmyid_bot`
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∞–º ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, `123456789`)

### –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ **"üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª –∏ –¥–æ—Å—Ç—É–ø"**
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é —Ä–æ–ª—å (Global/City/Logist)
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
4. –ù–∞–∂–º–∏—Ç–µ **"‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"**
5. –ì–æ—Ç–æ–≤–æ! –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏

### –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
2. –ù–∞–∂–º–∏—Ç–µ **"‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"**
3. –ì–æ—Ç–æ–≤–æ!

---

## –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–∏—Ç—å Global Admin

```
1. –ü–µ—Ä—Å–æ–Ω–∞–ª –∏ –¥–æ—Å—Ç—É–ø
2. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª
3. –í—ã–±—Ä–∞—Ç—å: üëë Global Admin
4. –í–≤–µ—Å—Ç–∏: 123456789
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
‚Üí ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å –¥–æ—Å—Ç—É–ø–æ–º –∫–æ –≤—Å–µ–º –≥–æ—Ä–æ–¥–∞–º
```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–∏—Ç—å City Admin –¥–ª—è 2 –≥–æ—Ä–æ–¥–æ–≤

```
1. –ü–µ—Ä—Å–æ–Ω–∞–ª –∏ –¥–æ—Å—Ç—É–ø
2. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª
3. –í—ã–±—Ä–∞—Ç—å: üèõ City Admin
4. –í–≤–µ—Å—Ç–∏: @ivan_admin
5. –í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥–∞: ‚úÖ –ú–æ—Å–∫–≤–∞, ‚úÖ –°–ü–±
6. –ì–æ—Ç–æ–≤–æ
7. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
‚Üí ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –ú–æ—Å–∫–≤–µ –∏ –°–ü–±
```

### –ü—Ä–∏–º–µ—Ä 3: –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏—Å—Ç–∞

```
1. –ü–µ—Ä—Å–æ–Ω–∞–ª –∏ –¥–æ—Å—Ç—É–ø
2. Logists
3. –í—ã–±—Ä–∞—Ç—å: @bad_logist
4. –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
‚Üí ‚ùå –°—Ç–∞—Ç—É—Å: –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
```

---

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### ‚ùì –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ –∑–Ω–∞–µ—Ç —Å–≤–æ–π ID?

–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –µ–≥–æ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É `@userinfobot` - –±–æ—Ç –ø–æ–∫–∞–∂–µ—Ç ID.

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ @username?

–î–∞! –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ `@username` –≤–º–µ—Å—Ç–æ ID.

### ‚ùì –ß—Ç–æ –µ—Å–ª–∏ username –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?

–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–æ—Å—Ç–æ –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏. –ó–∞–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –µ–≥–æ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–Ω–æ–≤–æ.

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è?

–ù–µ—Ç! –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç —ç—Ç–æ–≥–æ.

### ‚ùì –°—Ç–∞—Ä—ã–µ –∫–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞ –µ—â—ë —Ä–∞–±–æ—Ç–∞—é—Ç?

–î–∞, –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç. –ù–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π UI.

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å/–≥–æ—Ä–æ–¥–∞?

–ü–æ–∫–∞ –Ω–µ—Ç, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –°–µ–π—á–∞—Å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å.

---

## –ü—Ä–æ–±–ª–µ–º—ã?

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–∞—Ç—á–∞
python -c "from field_service.bots.admin_bot.services_db import DBStaffService; print('OK')"
```

### –ö–Ω–æ–ø–∫–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–æ—à–ª–∏ –∫–∞–∫ **Global Admin**
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

### –ù–µ –º–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É–∫–∞–∑–∞–ª–∏ –ª–∏–±–æ ID, –ª–∏–±–æ @username
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω

---

## üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

**–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `CR-2025-10-04-STAFF-UI-DOCS.md`

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 04.10.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
