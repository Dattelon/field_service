# ‚ö° –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç!

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ middleware

**–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞:**
```python
if tg_id in self._superusers:
    if not isinstance(staff, StaffUser):  # ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–ª–æ, –µ—Å–ª–∏ staff —É–∂–µ –±—ã–ª –æ–±—ä–µ–∫—Ç–æ–º
        resolved = await self._staff_service.get_by_tg_id(tg_id)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
if tg_id in self._superusers:
    # ‚úÖ –í–°–ï–ì–î–ê –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑ –ë–î, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∫—ç—à
    resolved = await self._staff_service.get_by_tg_id(tg_id)
```

---

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°:

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
python -m field_service.bots.admin_bot.main
```

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
1. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç ‚Üí üí∞ –§–∏–Ω–∞–Ω—Å—ã ‚Üí –û–∂–∏–¥–∞—é—Ç –æ–ø–ª–∞—Ç—ã
2. –í—ã–±—Ä–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é ‚Üí ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
3. **–î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ë–ï–ó –æ—à–∏–±–∫–∏!**

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–º–æ—á—å?

1. ‚úÖ –†–æ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞: `role = 'GLOBAL_ADMIN'` (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
2. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞: `if staff.id < 0` (—É–∂–µ –≤ –∫–æ–¥–µ)
3. ‚úÖ **Middleware —Ç–µ–ø–µ—Ä—å –í–°–ï–ì–î–ê –∑–∞–≥—Ä—É–∂–∞–µ—Ç staff.id=5 –∏–∑ –ë–î** (–Ω–æ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

---

## –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è:

–î–æ–±–∞–≤—å—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:

```python
# –í handlers_finance.py, —Å—Ç—Ä–æ–∫–∞ ~825
print(f"DEBUG: staff.id={staff.id}, staff.tg_id={staff.tg_id}")
ok = await finance_service.approve(...)
```

–ò —Å–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

**–°—Ç–∞—Ç—É—Å:** üü° –û–ñ–ò–î–ê–ù–ò–ï –ü–ï–†–ï–ó–ê–ü–£–°–ö–ê  
**–í—Ä–µ–º—è:** 03.10.2025, 22:45  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** HIGH
