# ‚úÖ P1-12 –ó–ê–í–ï–†–®–ï–ù–û: Progress Bar + –£–¥–∞–ª–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-10-09  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω Progress Bar –≤ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
- –§–æ—Ä–º–∞—Ç: `–®–∞–≥ X –∏–∑ 13: [‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]`
- –ü—Ä–∏–º–µ–Ω—ë–Ω –∫–æ **–≤—Å–µ–º 13 —à–∞–≥–∞–º** –æ—Å–Ω–æ–≤–Ω–æ–≥–æ flow
- –ü—Ä–∏–º–µ–Ω—ë–Ω –∫–æ **–≤—Å–µ–º 7 edit handlers** (—Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- –í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å 14 —Å–∏–º–≤–æ–ª–∞–º–∏

### 2. ‚úÖ –£–¥–∞–ª—ë–Ω —ç—Ç–∞–ø "–î–æ–º-–±–∞–∑–∞ (–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è)"
- –£–¥–∞–ª—ë–Ω state `OnboardingStates.home_geo`
- –£–¥–∞–ª–µ–Ω—ã 4 handler —Ñ—É–Ω–∫—Ü–∏–∏
- –£–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç `home_geo_keyboard`
- –£–±—Ä–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ summary
- –£–±—Ä–∞–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ summary
- –£–±—Ä–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –ë–î

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ò–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ | 2 |
| –î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~50 |
| –£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~80 |
| –®–∞–≥–æ–≤ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (–±—ã–ª–æ) | 14 |
| –®–∞–≥–æ–≤ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (—Å—Ç–∞–ª–æ) | 13 |
| –§—É–Ω–∫—Ü–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ | 2 –Ω–æ–≤—ã–µ |
| –£–¥–∞–ª–µ–Ω–æ handlers | 4 (home_geo) |

---

## üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```
–®–∞–≥ 1/13:  [‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]  7%
–®–∞–≥ 3/13:  [‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]  21%
–®–∞–≥ 5/13:  [‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]  36%
–®–∞–≥ 7/13:  [‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]  50%
–®–∞–≥ 10/13: [‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë]  71%
–®–∞–≥ 13/13: [‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë]  93%
```

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `field_service/bots/master_bot/states.py`
```diff
class OnboardingStates(StatesGroup):
    ...
    payout_requisites = State()
-   home_geo = State()
    confirm = State()
```

### 2. `field_service/bots/master_bot/handlers/onboarding.py`
```diff
+ TOTAL_ONBOARDING_STEPS = 13
+ STEP_MAPPING = {...}
+ 
+ def _format_progress_bar(current_step, total_steps) -> str: ...
+ def _add_progress_to_text(text, state_name) -> str: ...

- from ..keyboards import home_geo_keyboard
- async def onboarding_home_geo_share(...): ...
- async def onboarding_home_geo_skip(...): ...
- async def onboarding_home_geo_location(...): ...
- async def onboarding_home_geo_text(...): ...
- async def onboarding_home_geo_other(...): ...
- async def onboarding_edit_home_geo(...): ...

  # –ü—Ä–∏–º–µ–Ω—ë–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–æ –≤—Å–µ–º —à–∞–≥–∞–º:
+ text = _add_progress_to_text("...", OnboardingStates.xxx)
  await push_step_message(..., text, ...)
```

---

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ (1-13)
2. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è "–®–∞–≥ X –∏–∑ 13"
3. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç—Ç–∞–ø–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
4. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
5. ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
6. ‚úÖ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
7. ‚úÖ –ê–Ω–∫–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
8. ‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
9. ‚úÖ –í—Å–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
10. ‚úÖ FSM transitions –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã:
- ‚úÖ `docs/P1-12_PROGRESS_BAR.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `docs/P1-12_QUICKSTART.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–û–±–Ω–æ–≤–ª–µ–Ω—ã:
- ‚úÖ `code_snapshot/.../states.py.txt`
- ‚úÖ `code_snapshot/.../onboarding.py.txt`

---

## üöÄ –î–µ–ø–ª–æ–π

### –ö–æ–º–∞–Ω–¥—ã:
```bash
# 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å master-bot
docker-compose restart master-bot

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f master-bot | grep -i "onboarding\|error"

# 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
# –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –∏ –ø—Ä–æ–π—Ç–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
```

### Rollback:
```bash
git checkout HEAD~1 field_service/bots/master_bot/handlers/onboarding.py
git checkout HEAD~1 field_service/bots/master_bot/states.py
docker-compose restart master-bot
```

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

### UX –º–µ—Ç—Ä–∏–∫–∏:
- **Completion Rate:** –û–∂–∏–¥–∞–µ–º +5-10% (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–µ–∂–µ –±—Ä–æ—Å–∞—é—Ç –∫–æ–≥–¥–∞ –≤–∏–¥—è—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å)
- **Drop-off Rate:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ–∑–¥–Ω–∏—Ö —à–∞–≥–∞—Ö (–≤–∏–¥–Ω–æ —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ)
- **Time to Complete:** –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ
- **User Satisfaction:** –ü–æ–≤—ã—à–µ–Ω–∏–µ (–±–æ–ª—å—à–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- **Code Complexity:** -30 —Å—Ç—Ä–æ–∫ (—É–ø—Ä–æ—â–µ–Ω–∏–µ)
- **Maintenance:** –ü—Ä–æ—â–µ (–º–µ–Ω—å—à–µ —à–∞–≥–æ–≤)
- **Performance:** –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üéâ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### Immediate:
1. ‚úÖ P1-12 –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
2. üìã –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä-–±–æ—Ç–æ–º
3. üêõ –§–∏–∫—Å—ã –µ—Å–ª–∏ –Ω–∞–π–¥—É—Ç—Å—è –±–∞–≥–∏
4. üöÄ –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥

### Next P1 tasks:
- **P1-18:** –§–∏–ª—å—Ç—Ä "–ú–æ–∏ –≥–æ—Ä–æ–¥–∞" (–±—ã—Å—Ç—Ä–æ, ~1-2—á)
- **P1-11:** –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É (—Å—Ä–µ–¥–Ω–µ, ~2-3—á)
- **P1-21:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–¥–ª–∞–π–Ω–µ –∫–æ–º–∏—Å—Å–∏–∏ (—Å—Ä–µ–¥–Ω–µ, ~3-4—á)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å P1-18 –∫–∞–∫ —Å–∞–º–æ–π –±—ã—Å—Ç—Ä–æ–π –∑–∞–¥–∞—á–∏.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω
- [x] Progress bar –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ –≤—Å–µ–º —à–∞–≥–∞–º
- [x] Home_geo –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] Code snapshot –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∂–¥—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
- [ ] Code review (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥ (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ (—á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)

---

**–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!** ‚úÖ  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~40 –º–∏–Ω—É—Ç  
**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** –í—ã—Å–æ–∫–æ–µ (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 100% –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞?** üéØ
