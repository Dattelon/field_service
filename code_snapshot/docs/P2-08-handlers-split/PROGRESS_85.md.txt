# ‚úÖ P2-08: –†–ê–ó–ë–ò–ï–ù–ò–ï handlers.py –ù–ê –ú–û–î–£–õ–ò - –ó–ê–í–ï–†–®–ï–ù–û 85%

## üìã –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ handlers/** (6 –º–æ–¥—É–ª–µ–π) ‚ú®

```
field_service/bots/admin_bot/handlers/
‚îú‚îÄ‚îÄ __init__.py          # –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ (40 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ helpers.py           # –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (200 —Å—Ç—Ä–æ–∫, 50+ —Ñ—É–Ω–∫—Ü–∏–π)
‚îú‚îÄ‚îÄ menu.py              # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (120 —Å—Ç—Ä–æ–∫, 5 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
‚îú‚îÄ‚îÄ logs.py              # –õ–æ–≥–∏ (80 —Å—Ç—Ä–æ–∫, 3 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞)
‚îú‚îÄ‚îÄ orders.py            # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ (1100 —Å—Ç—Ä–æ–∫, 50+ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
‚îî‚îÄ‚îÄ settings.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã (450 —Å—Ç—Ä–æ–∫, 5 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤) ‚ú® –ù–û–í–û–ï
```

**–í—Å–µ–≥–æ:** 1990 —Å—Ç—Ä–æ–∫ –≤ –º–æ–¥—É–ª—è—Ö handlers/

---

### 2. **settings.py** (~450 —Å—Ç—Ä–æ–∫) ‚ú® **–ù–û–í–´–ô –ú–û–î–£–õ–¨**

**–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ (SettingsEditFSM):**

#### –ì—Ä—É–ø–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ (6 –≥—Ä—É–ø–ø):
1. **workday** - –†–∞–±–æ—á–∏–π –¥–µ–Ω—å (2 –ø–æ–ª—è)
   - `working_hours_start` - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è
   - `working_hours_end` - –ö–æ–Ω–µ—Ü —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è

2. **distribution** - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (5 –ø–æ–ª–µ–π)
   - `distribution_tick_seconds` - –®–∞–≥ —Ü–∏–∫–ª–∞
   - `distribution_sla_seconds` - SLA –æ—Ç–≤–µ—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞
   - `distribution_rounds` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤
   - `escalate_to_admin_after_min` - –≠—Å–∫–∞–ª–∞—Ü–∏—è –∫ –∞–¥–º–∏–Ω—É
   - `distribution_log_topn` - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å topN

3. **limits** - –õ–∏–º–∏—Ç—ã (1 –ø–æ–ª–µ)
   - `max_active_orders` - –ú–∞–∫—Å. –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

4. **support** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (2 –ø–æ–ª—è)
   - `support_contact` - –ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - `support_faq_url` - –°—Å—ã–ª–∫–∞ –Ω–∞ FAQ

5. **geo** - –ì–µ–æ–∫–æ–¥–µ—Ä (4 –ø–æ–ª—è)
   - `geo_mode` - –†–µ–∂–∏–º –≥–µ–æ–∫–æ–¥–µ—Ä–∞ (choice: local_centroids / yandex)
   - `yandex_geocoder_key` - API-–∫–ª—é—á –Ø–Ω–¥–µ–∫—Å
   - `yandex_throttle_rps` - RPS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
   - `yandex_daily_limit` - –°—É—Ç–æ—á–Ω—ã–π –ª–∏–º–∏—Ç

6. **channels** - –ö–∞–Ω–∞–ª—ã Telegram (3 –ø–æ–ª—è)
   - `alerts_channel_id` - –ö–∞–Ω–∞–ª –∞–ª–µ—Ä—Ç–æ–≤
   - `logs_channel_id` - –ö–∞–Ω–∞–ª –ª–æ–≥–æ–≤
   - `reports_channel_id` - –ö–∞–Ω–∞–ª –æ—Ç—á—ë—Ç–æ–≤

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (5):
1. ‚úÖ `cb_settings_menu` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ (adm:s)
2. ‚úÖ `cb_settings_group` - –ü–æ–∫–∞–∑–∞—Ç—å –≥—Ä—É–ø–ø—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ (adm:s:group:*)
3. ‚úÖ `cb_settings_edit_start` - –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (adm:s:edit:*)
4. ‚úÖ `settings_edit_cancel` - –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (/cancel)
5. ‚úÖ `settings_edit_value` - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

#### Dataclasses (2):
- `SettingFieldDef` - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `SettingGroupDef` - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### –•–µ–ª–ø–µ—Ä—ã (7 —Ñ—É–Ω–∫—Ü–∏–π):
- `_get_setting_group(key)` - –ü–æ–ª—É—á–∏—Ç—å –≥—Ä—É–ø–ø—É –ø–æ –∫–ª—é—á—É
- `_get_setting_field(key)` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–µ –ø–æ –∫–ª—é—á—É
- `_format_setting_value(field, raw)` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è UI
- `_choice_help(field)` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–º–æ—â–∏ –¥–ª—è choice
- `_build_setting_prompt(field, current)` - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ prompt
- `_parse_setting_input(field, input)` - –ü–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- `_build_settings_view(bot, group_key)` - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã

#### –°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (7):
- `time` - –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú
- `int` - –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
- `int_non_negative` - –ù–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
- `int_optional` - –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –∏–ª–∏ "-" –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
- `string` - –ù–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
- `string_optional` - –°—Ç—Ä–æ–∫–∞ –∏–ª–∏ "-" –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
- `choice` - –í—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

### –°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: 6
- `handlers/__init__.py` (40 —Å—Ç—Ä–æ–∫) +5 —Å—Ç—Ä–æ–∫
- `handlers/helpers.py` (200 —Å—Ç—Ä–æ–∫)
- `handlers/menu.py` (120 —Å—Ç—Ä–æ–∫)
- `handlers/logs.py` (80 —Å—Ç—Ä–æ–∫)
- `handlers/orders.py` (1100 —Å—Ç—Ä–æ–∫)
- `handlers/settings.py` (450 —Å—Ç—Ä–æ–∫) ‚ú® **–ù–û–í–û–ï**

### –í—ã–Ω–µ—Å–µ–Ω–æ –∏–∑ handlers.py:
- **~1750 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** (—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)
- **65+ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** (menu: 5, logs: 3, orders: 50+, settings: 5)
- **75+ —Ñ—É–Ω–∫—Ü–∏–π** (—Ö–µ–ª–ø–µ—Ä—ã)

### handlers.py —Å–µ–π—á–∞—Å:
- **–ë—ã–ª–æ:** 95KB (~3000 —Å—Ç—Ä–æ–∫)
- **–°—Ç–∞–ª–æ:** ~55KB (~1700 —Å—Ç—Ä–æ–∫) ‚¨áÔ∏è **-43%**
- **–û—Å—Ç–∞–ª–æ—Å—å –≤—ã–Ω–µ—Å—Ç–∏:** ~500 —Å—Ç—Ä–æ–∫ (reports, staff_access)

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ handlers/ —Å–æ–∑–¥–∞–Ω–∞ (6 –º–æ–¥—É–ª–µ–π)
- [x] –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ helpers.py
- [x] –ú–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ menu.py
- [x] –õ–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ logs.py
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ orders.py
- [x] **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ settings.py** ‚ú®
- [x] –í—Å–µ 6 –≥—Ä—É–ø–ø –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –†–æ—É—Ç–µ—Ä—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ __init__.py
- [x] main.py –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
- [x] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- [x] –í—Å–µ –º–æ–¥—É–ª–∏ –∏–º–µ—é—Ç docstrings
- [x] –§—É–Ω–∫—Ü–∏–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ò–º–ø–æ—Ä—Ç—ã —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã
- [x] __all__ —ç–∫—Å–ø–æ—Ä—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [x] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç PEP 8
- [x] –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (DRY)
- [x] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è dataclasses –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞

---

## üìù –û—Å—Ç–∞–ª–æ—Å—å –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (15%)

### –°–æ–∑–¥–∞—Ç—å –µ—â—ë 2 –º–æ–¥—É–ª—è:

1. **reports.py** (~200 —Å—Ç—Ä–æ–∫, 1 —á–∞—Å)
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ReportsExportFSM
   - –≠–∫—Å–ø–æ—Ä—Ç CSV/XLSX (orders, commissions, referral_rewards)
   - –ë—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–∏–æ–¥—ã (—Å–µ–≥–æ–¥–Ω—è, –≤—á–µ—Ä–∞, last7, this_month, prev_month)
   - –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (YYYY-MM-DD YYYY-MM-DD)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Reports channel –∏–ª–∏ –∞–¥–º–∏–Ω—É
   - ~10 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

2. **staff_access.py** (~150 —Å—Ç—Ä–æ–∫, 1 —á–∞—Å)
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ StaffAccessFSM (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
   - –í–≤–æ–¥ access code
   - PDN —Å–æ–≥–ª–∞—Å–∏–µ
   - –í–≤–æ–¥ –§–ò–û
   - –í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   - ~5 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ handlers.py:
- –° **95KB** –¥–æ **~40KB** (**-58%**)
- –° **3000 —Å—Ç—Ä–æ–∫** –¥–æ **~1200 —Å—Ç—Ä–æ–∫**

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

### –î–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è:
- `handlers.py`: **95KB** (3000 —Å—Ç—Ä–æ–∫)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π: **~150**
- –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: **‚ùå –ù–∏–∑–∫–∞—è**
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å: **‚ùå –°–ª–æ–∂–Ω–∞—è**

### –ü–æ—Å–ª–µ —Ä–∞–∑–±–∏–µ–Ω–∏—è (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ):
- `handlers.py`: **~55KB** (1700 —Å—Ç—Ä–æ–∫) ‚¨áÔ∏è **-43%**
- `handlers/`: **6 –º–æ–¥—É–ª–µ–π** (1990 —Å—Ç—Ä–æ–∫)
- –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: **‚úÖ –û—Ç–ª–∏—á–Ω–∞—è**
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å: **‚úÖ –•–æ—Ä–æ—à–∞—è**

### –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (—Ü–µ–ª—å):
- `handlers.py`: **~40KB** (1200 —Å—Ç—Ä–æ–∫) ‚¨áÔ∏è **-58%**
- `handlers/`: **8 –º–æ–¥—É–ª–µ–π** (2340 —Å—Ç—Ä–æ–∫)
- –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: **‚úÖ –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è**
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å: **‚úÖ –û—Ç–ª–∏—á–Ω–∞—è**

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å settings.py

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–¥–º–∏–Ω-–±–æ—Ç–∞
```bash
python -m field_service.bots.admin_bot.main
```

### 2. –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –≤ –∞–¥–º–∏–Ω-–±–æ—Ç (–∫–∞–∫ GLOBAL_ADMIN)
2. –ù–∞–∂–∞—Ç—å "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è 6 –≥—Ä—É–ø–ø:
   - üïô –†–∞–±–æ—á–∏–π –¥–µ–Ω—å
   - ‚öñÔ∏è –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
   - ‚õîÔ∏è –õ–∏–º–∏—Ç—ã
   - üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞
   - üó∫ –ì–µ–æ
   - üì£ –ö–∞–Ω–∞–ª—ã

### 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
1. –í—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "üïô –†–∞–±–æ—á–∏–π –¥–µ–Ω—å")
2. –ù–∞–∂–∞—Ç—å –Ω–∞ –ø–æ–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è")
3. –í–≤–µ—Å—Ç–∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `09:00`)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å
5. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø–µ

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
1. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–≤–µ—Å—Ç–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `25:00`)
2. –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –æ—à–∏–±–∫–∞ "–ß–∞—Å—ã: 0-23, –º–∏–Ω—É—Ç—ã: 0-59"
3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–≤–µ—Å—Ç–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `abc`)
4. –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –æ—à–∏–±–∫–∞ "–û–∂–∏–¥–∞–µ—Ç—Å—è —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ"

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å choice-–ø–æ–ª—è
1. –û—Ç–∫—Ä—ã—Ç—å –≥—Ä—É–ø–ø—É "üó∫ –ì–µ–æ"
2. –ù–∞–∂–∞—Ç—å "–†–µ–∂–∏–º –≥–µ–æ–∫–æ–¥–µ—Ä–∞"
3. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã:
   - 1. –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã (local_centroids)
   - 2. –Ø–Ω–¥–µ–∫—Å (yandex)
4. –í–≤–µ—Å—Ç–∏ `1` –∏–ª–∏ `yandex` - –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

### 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å /cancel
1. –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª—é–±–æ–≥–æ –ø–æ–ª—è
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/cancel`
3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å—Å—è

---

## üî• –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. Dataclass-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
–í—Å–µ –≥—Ä—É–ø–ø—ã –∏ –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–ø–∏—Å–∞–Ω—ã —á–µ—Ä–µ–∑ dataclasses:
```python
@dataclass(frozen=True)
class SettingFieldDef:
    key: str
    label: str
    schema: str
    value_type: str = "STR"
    choices: tuple[tuple[str, str], ...] | None = None
```

### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
–í—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `_parse_setting_input`:
- time: regex + –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
- int: positive integer
- int_non_negative: >= 0
- choice: –ø–æ–∏—Å–∫ –≤ —Å–ø–∏—Å–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- string_optional: –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º

### 3. –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
```python
SETTING_FIELD_BY_KEY: dict[str, SettingFieldDef]
SETTING_FIELD_GROUP: dict[str, str]
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ source message
–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≥—Ä—É–ø–ø–æ–π:
```python
await msg.bot.edit_message_text(
    view_text,
    chat_id=source_chat_id,
    message_id=source_message_id,
)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **GLOBAL_ADMIN only:**
   - –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ GLOBAL_ADMIN
   - –§–∏–ª—å—Ç—Ä `StaffRoleFilter({StaffRole.GLOBAL_ADMIN})`

2. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
   - –ë–µ—Ä—É—Ç—Å—è –∏–∑ `env_settings` (field_service.config.settings)
   - –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–º–µ—Ç–∫–æ–π "(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É:**
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (working_hours)

4. **choice-–ø–æ–ª—è:**
   - –ú–æ–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å: code, label, –∏–ª–∏ –Ω–æ–º–µ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞
   - –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

---

## üöÄ –°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞

**–ó–∞–¥–∞—á–∞ P2-08 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –Ω–∞ 85%.**

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è –º–æ–¥—É–ª–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
1. ‚¨ú reports.py (~200 —Å—Ç—Ä–æ–∫, 1 —á–∞—Å)
2. ‚¨ú staff_access.py (~150 —Å—Ç—Ä–æ–∫, 1 —á–∞—Å)

**–í—Ä–µ–º—è –Ω–∞ –ø–æ–ª–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** ~2 —á–∞—Å–∞

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:**
- ‚úÖ helpers.py
- ‚úÖ menu.py
- ‚úÖ logs.py
- ‚úÖ orders.py
- ‚úÖ settings.py
- ‚¨ú reports.py (–æ—Å—Ç–∞–ª–æ—Å—å)
- ‚¨ú staff_access.py (–æ—Å—Ç–∞–ª–æ—Å—å)

---

‚úÖ **–í–´–ü–û–õ–ù–ï–ù–ò–ï 85% –ó–ê–í–ï–†–®–ï–ù–û**
‚è±Ô∏è **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~3 —á–∞—Å–∞
üì¶ **–°–æ–∑–¥–∞–Ω–æ –º–æ–¥—É–ª–µ–π:** 6
üìâ **–£–º–µ–Ω—å—à–µ–Ω–∏–µ handlers.py:** ~43% (95KB ‚Üí 55KB)
üéØ **–í—ã–Ω–µ—Å–µ–Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** 65+
üìê **–í—ã–Ω–µ—Å–µ–Ω–æ —Ñ—É–Ω–∫—Ü–∏–π:** 75+
