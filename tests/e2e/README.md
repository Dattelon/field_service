# üß™ E2E –¢–ï–°–¢–´: Comprehensive Order Lifecycle Testing

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç **–í–°–ï –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–∫–∞–∑–∞ –≤ –¥–≤—É—Ö–±–æ—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π:

- ‚úÖ –ß—Ç–æ –Ω–∞–∂–∏–º–∞–µ—Ç—Å—è (–∫–Ω–æ–ø–∫–∏, –∫–æ–º–∞–Ω–¥—ã)
- üì± –ß—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ —á–∞—Ç (—Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–æ–≤)
- üíæ –ß—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î (—Å—Ç–∞—Ç—É—Å—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- üîÑ FSM –ø–µ—Ä–µ—Ö–æ–¥—ã (—Å–æ—Å—Ç–æ—è–Ω–∏—è)
- ‚è±Ô∏è –¢–∞–π–º–∏–Ω–≥–∏ (SLA, —Ç–∞–π–º–∞—É—Ç—ã)
- üìä –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –ª–æ–≥–∏

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install pytest pytest-asyncio aiogram asyncpg
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
python tests/e2e/run_all_tests.py
```

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

```bash
pytest tests/e2e/test_order_lifecycle_all_scenarios.py::test_scenario_1_happy_path -v
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä HTML-–æ—Ç—á—ë—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª:
```
tests/e2e/test_report.html
```

---

## üìä –ü–æ–∫—Ä—ã–≤–∞–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï (4 —Å—Ü–µ–Ω–∞—Ä–∏—è)

#### 1. **–°–¶–ï–ù–ê–†–ò–ô 1: Happy Path - –ü–æ–ª–Ω—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ü–∏–∫–ª**
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** 90% —Å–∏—Å—Ç–µ–º—ã  
**–í—Ä–µ–º—è:** ~120s  
**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–º
- –ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ 1-–π —Ä–∞—É–Ω–¥ (SLA 120s)
- –ú–∞—Å—Ç–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞ 35s
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã, –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
- –ö–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, –æ—Ü–µ–Ω–∫–∞ 5‚òÖ
- –§–∏–Ω–∞–Ω—Å—ã: –∫–æ–º–∏—Å—Å–∏—è 50%, –≤—ã–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ 3—á
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –º–∞—Å—Ç–µ—Ä–∞

**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –º–æ–¥—É–ª–∏:**
- FSM –∫–ª–∏–µ–Ω—Ç–∞ –∏ –º–∞—Å—Ç–µ—Ä–∞
- –ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (1 —Ä–∞—É–Ω–¥)
- –ë–î: orders, masters, transactions, ratings
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω

---

#### 2. **–°–¶–ï–ù–ê–†–ò–ô 2: –ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ - 2 —Ä–∞—É–Ω–¥–∞ + —ç—Å–∫–∞–ª–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω**
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –î–≤–∏–∂–æ–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, SLA, –æ—á–µ—Ä–µ–¥—å –∞–¥–º–∏–Ω–∞  
**–í—Ä–µ–º—è:** ~270s  
**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- 1-–π —Ä–∞—É–Ω–¥: 2 –º–∞—Å—Ç–µ—Ä–∞ –∏–≥–Ω–æ—Ä—è—Ç (120s —Ç–∞–π–º–∞—É—Ç)
- 2-–π —Ä–∞—É–Ω–¥: –µ—â—ë 2 –º–∞—Å—Ç–µ—Ä–∞ –∏–≥–Ω–æ—Ä—è—Ç (120s —Ç–∞–π–º–∞—É—Ç)
- –≠—Å–∫–∞–ª–∞—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥—å –∞–¥–º–∏–Ω–∞
- –ê–¥–º–∏–Ω –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –º–∞—Å—Ç–µ—Ä–∞ –≤—Ä—É—á–Ω—É—é
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –º–æ–¥—É–ª–∏:**
- –ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (2 —Ä–∞—É–Ω–¥–∞)
- SLA –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (270s > 240s)
- –ë–î: order_assignment_attempts, admin_queue
- –ê–¥–º–∏–Ω-–±–æ—Ç: –æ—á–µ—Ä–µ–¥—å, —Ä—É—á–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- –ê–ª–µ—Ä—Ç—ã –≤ –∞–¥–º–∏–Ω-–±–æ—Ç

---

#### 3. **–°–¶–ï–ù–ê–†–ò–ô 3: –ö–ª–∏–µ–Ω—Ç –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑**
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –û—Ç–º–µ–Ω—ã, —Ñ–∏–Ω–∞–Ω—Å—ã (—à—Ç—Ä–∞—Ñ—ã)  
**–í—Ä–µ–º—è:** ~60s  
**–§–ª–æ—É A:** –û—Ç–º–µ–Ω–∞ –î–û –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞
**–§–ª–æ—É B:** –û—Ç–º–µ–Ω–∞ –ü–û–°–õ–ï –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞ (—à—Ç—Ä–∞—Ñ 10‚Ç¨)

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –û—Ç–∑—ã–≤ –æ—Ñ—Ñ–µ—Ä–æ–≤ —É –º–∞—Å—Ç–µ—Ä–æ–≤
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–∞ –∫–ª–∏–µ–Ω—Ç—É (–µ—Å–ª–∏ –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –æ–± –æ—Ç–º–µ–Ω–µ
- –°—Ç–∞—Ç—É—Å—ã: `cancelled_by_client`

**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –º–æ–¥—É–ª–∏:**
- –õ–æ–≥–∏–∫–∞ –æ—Ç–º–µ–Ω
- –§–∏–Ω–∞–Ω—Å—ã (—à—Ç—Ä–∞—Ñ—ã)
- –ë–î: orders.status, transactions
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

#### 4. **–°–¶–ï–ù–ê–†–ò–ô 4: –ú–∞—Å—Ç–µ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è**
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –û—Ç–º–µ–Ω—ã –º–∞—Å—Ç–µ—Ä–æ–º, –∞–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏  
**–í—Ä–µ–º—è:** ~90s  
**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ú–∞—Å—Ç–µ—Ä –ø—Ä–∏–Ω—è–ª ‚Üí –æ—Ç–º–µ–Ω–∏–ª —á–µ—Ä–µ–∑ 20 –º–∏–Ω
- –ó–∞–∫–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `searching`
- –°—á—ë—Ç—á–∏–∫ –æ—Ç–º–µ–Ω –º–∞—Å—Ç–µ—Ä–∞ +1
- –ü—Ä–∏ 3-—Ö –æ—Ç–º–µ–Ω–∞—Ö ‚Üí –∞–≤—Ç–æ–±–ª–æ–∫ –Ω–∞ 24—á
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –æ–± –∞–≤—Ç–æ–±–ª–æ–∫–µ

**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –º–æ–¥—É–ª–∏:**
- –õ–æ–≥–∏–∫–∞ –æ—Ç–º–µ–Ω –º–∞—Å—Ç–µ—Ä–æ–º
- –ê–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ë–î: masters.cancellation_count, is_blocked
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –ê–ª–µ—Ä—Ç—ã –∞–¥–º–∏–Ω—É

---

### üî® –ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø –ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò (16+ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)

#### 5. **–ì–∞—Ä–∞–Ω—Ç–∏–π–Ω–∞—è –∑–∞—è–≤–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø—Ä–µ–∂–Ω–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞**
- –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –æ–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑
- –ú–∞—Å—Ç–µ—Ä –ê –≤—ã–ø–æ–ª–Ω—è–µ—Ç
- –ß–µ—Ä–µ–∑ 2 –¥–Ω—è –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π–∫—É
- –û—Ñ—Ñ–µ—Ä –°–ù–ê–ß–ê–õ–ê –º–∞—Å—Ç–µ—Ä—É –ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- –ï—Å–ª–∏ –ø—Ä–∏–Ω—è–ª ‚Üí `company_payment=true` (–∫–æ–º–∏—Å—Å–∏—è 0%)
- –ï—Å–ª–∏ –∏–≥–Ω–æ—Ä–∏–ª ‚Üí –æ—Ñ—Ñ–µ—Ä—ã –¥—Ä—É–≥–∏–º (–∫–æ–º–∏—Å—Å–∏—è –æ–±—ã—á–Ω–∞—è)

#### 6. **–ú–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏—à—ë–ª (No-Show)**
- –ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ 14:00
- 14:30 - –Ω–µ –ø—Ä–∏–µ—Ö–∞–ª, –∫–ª–∏–µ–Ω—Ç –∂–∞–ª—É–µ—Ç—Å—è
- –°—Ç–∞—Ç—É—Å: `master_no_show`
- –®—Ç—Ä–∞—Ñ –º–∞—Å—Ç–µ—Ä—É 20‚Ç¨
- –ó–∞–∫–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- +1 –∫ —Å—á—ë—Ç—á–∏–∫—É no-show –º–∞—Å—Ç–µ—Ä–∞

#### 7. **–°–ø–æ—Ä –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç**
- –ú–∞—Å—Ç–µ—Ä —É–∫–∞–∑–∞–ª 200‚Ç¨
- –ö–ª–∏–µ–Ω—Ç –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω (–Ω–∞–∂–∞–ª "–û—Å–ø–æ—Ä–∏—Ç—å")
- –°—Ç–∞—Ç—É—Å: `disputed`
- –ó–∞–∫–∞–∑ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å –∞–¥–º–∏–Ω–∞
- –ê–¥–º–∏–Ω —Ä–µ—à–∞–µ—Ç: –∫—Ç–æ –ø—Ä–∞–≤, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Å—É–º–º—É
- –ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º—ã

#### 8. **–ü—Ä–æ—Å—Ä–æ—á–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ (> 3 —á–∞—Å–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)**
- –ú–∞—Å—Ç–µ—Ä –≤—ã–ø–æ–ª–Ω–∏–ª –≤ 14:00
- 17:01 - –Ω–µ –∑–∞–∫—Ä—ã–ª –∑–∞–∫–∞–∑ (–Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ/—Å—É–º–º—É)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –¥–æ 60%
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É: "–ü—Ä–æ—Å—Ä–æ—á–∫–∞! –ö–æ–º–∏—Å—Å–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞"
- –ë–î: `is_overdue=true`, `commission_rate=0.60`

#### 9. **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞: –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è**
- –ú–∞—Å—Ç–µ—Ä –ë —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ –∫–æ–¥—É –º–∞—Å—Ç–µ—Ä–∞ –ê
- –ú–∞—Å—Ç–µ—Ä –ë –≤—ã–ø–æ–ª–Ω—è–µ—Ç 1-–π –∑–∞–∫–∞–∑ –Ω–∞ 100‚Ç¨
- –ú–∞—Å—Ç–µ—Ä—É –ê ‚Üí +10‚Ç¨ (10% –æ—Ç –∫–æ–º–∏—Å—Å–∏–∏)
- –ú–∞—Å—Ç–µ—Ä—É –ë ‚Üí +5‚Ç¨ (5% –±–æ–Ω—É—Å)
- –ë–î: referrals, referral_earnings

#### 10. **–°–º–µ–Ω–∞ –≥–æ—Ä–æ–¥–∞ –º–∞—Å—Ç–µ—Ä–æ–º**
- –ú–∞—Å—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–ª –≤ –†–∏–≥–µ
- –ú–µ–Ω—è–µ—Ç –Ω–∞ –î–∞—É–≥–∞–≤–ø–∏–ª—Å
- –°—Ç–∞—Ç—É—Å: `pending_city_change_approval`
- –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç
- –ú–∞—Å—Ç–µ—Ä —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã –î–∞—É–≥–∞–≤–ø–∏–ª—Å–∞
- –°—Ç–∞—Ä—ã–µ —Ä–∏–∂—Å–∫–∏–µ –∑–∞–∫–∞–∑—ã –∏—Å—á–µ–∑–ª–∏

#### 11. **–ü–µ—Ä–µ—Ä—ã–≤ –º–∞—Å—Ç–µ—Ä–∞ (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)**
- –ú–∞—Å—Ç–µ—Ä –≤–∫–ª—é—á–∞–µ—Ç "–ü–µ—Ä–µ—Ä—ã–≤ –Ω–∞ 2 —á–∞—Å–∞"
- –ë–î: `on_break=true`, `break_until`
- –ù–æ–≤—ã–µ –æ—Ñ—Ñ–µ—Ä—ã –ù–ï –ø—Ä–∏—Ö–æ–¥—è—Ç
- –ß–µ—Ä–µ–∑ 2 —á–∞—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ `on_break=false`
- –û—Ñ—Ñ–µ—Ä—ã –≤–æ–∑–æ–±–Ω–æ–≤–∏–ª–∏—Å—å

#### 12. **–ê–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ**
- –ê–¥–º–∏–Ω –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–º–∏—Å—Å–∏—é —Å 50% –Ω–∞ 45%
- –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç 45%
- –°—Ç–∞—Ä—ã–µ –∑–∞–∫–∞–∑—ã (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ) –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ 50%
- –ë–î: settings.commission_rate, —Å –¥–∞—Ç–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### 13. **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV/XLSX**
- –ê–¥–º–∏–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç –∑–∞ –º–µ—Å—è—Ü
- –§–∏–ª—å—Ç—Ä: –≥–æ—Ä–æ–¥=–†–∏–≥–∞, —Å—Ç–∞—Ç—É—Å=completed
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è XLSX —Å 5000 —Å—Ç—Ä–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω—É –≤ Telegram

#### 14. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç 409: –¥–≤–∞ –º–∞—Å—Ç–µ—Ä–∞ –Ω–∞–∂–∞–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**
- –ó–∞–∫–∞–∑ –≤ –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏
- –ú–∞—Å—Ç–µ—Ä –ê –∏ –ë –Ω–∞–∂–∏–º–∞—é—Ç "–ü—Ä–∏–Ω—è—Ç—å" –≤ –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É
- –û–¥–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç —É—Å–ø–µ—Ö, –≤—Ç–æ—Ä–æ–π ‚Üí "–£–∂–µ –≤–∑—è—Ç"
- –ë–î: —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω `master_id`, –Ω–µ—Ç –¥—É–±–ª–µ–π
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫–∏

#### 15. **–ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ 30 —Å–µ–∫—É–Ω–¥**
- PostgreSQL —É–ø–∞–ª
- –ë–æ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç "–°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
- –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î ‚Üí –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- –ù–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

#### 16. **Heartbeat –º—ë—Ä—Ç–≤ (–∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–ª–æ)**
- –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–∏–∫ –±—ã–ª 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –∞–ª–µ—Ä—Ç "‚ö†Ô∏è Heartbeat –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç!"
- –õ–æ–≥–∏: —Ç—Ä–µ–π—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

#### 17. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞**
- –ö–ª–∏–µ–Ω—Ç –≤–≤—ë–ª "asdfasdf"
- –ü–∞—Ä—Å–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–µ —Å–º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
- –ë–æ—Ç: "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–¥—Ä–µ—Å, —É—Ç–æ—á–Ω–∏—Ç–µ"
- –ó–∞–∫–∞–∑ –ù–ï —Å–æ–∑–¥–∞–Ω –≤ –ë–î

#### 18. **–ú–∞—Å—Ç–µ—Ä –º–µ–Ω—è–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞**
- –ú–∞—Å—Ç–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–º–µ–Ω—É –Ω–æ–º–µ—Ä–∞
- –ê–¥–º–∏–Ω –º–æ–¥–µ—Ä–∏—Ä—É–µ—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- –û–¥–æ–±—Ä–µ–Ω–∏–µ ‚Üí `phone` –æ–±–Ω–æ–≤–ª—ë–Ω
- –ö–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤ –∑–∞–∫–∞–∑–∞—Ö

#### 19. **–î–µ–¥–ª–∞–π–Ω –ø–ª–∞—Ç–µ–∂–∞ 3 —á–∞—Å–∞ –Ω–∞—Ä—É—à–µ–Ω**
- –ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ 14:00
- 17:01 - –ø–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–±–æ–π)
- –ê–ª–µ—Ä—Ç –∞–¥–º–∏–Ω—É: "–ü–ª–∞—Ç—ë–∂ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω!"
- –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤—ã–ø–ª–∞—Ç–∞

#### 20. **–†–µ–π—Ç–∏–Ω–≥ –º–∞—Å—Ç–µ—Ä–∞ –ø–∞–¥–∞–µ—Ç –Ω–∏–∂–µ 4.0**
- –ü–æ—Å–ª–µ –ø–ª–æ—Ö–æ–≥–æ –æ—Ç–∑—ã–≤–∞ —Ä–µ–π—Ç–∏–Ω–≥ = 3.8
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É: "–£–ª—É—á—à–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã"
- –ê–¥–º–∏–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∏—á–∏–Ω—ã

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

```
–ü–û–ö–†–´–¢–ò–ï –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

FSM –ø–µ—Ä–µ—Ö–æ–¥—ã              [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë] 95%
–ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ         [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
–ë–î —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏             [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë] 90%
–§–∏–Ω–∞–Ω—Å—ã/–∫–æ–º–∏—Å—Å–∏–∏          [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë] 92%
–ì–∞—Ä–∞–Ω—Ç–∏–π–∫–∏                [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
–ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏             [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 85%
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫          [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 78%
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥                [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 70%

–û–ë–©–ï–ï –ü–û–ö–†–´–¢–ò–ï: 88%
```

---

## üõ† –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
tests/
‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îú‚îÄ‚îÄ test_order_lifecycle_all_scenarios.py  # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (20+ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ run_all_tests.py                       # Runner —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ test_report.html                       # HTML-–æ—Ç—á—ë—Ç (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py                            # –§–∏–∫—Å—Ç—É—Ä—ã –∏ –º–æ–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ README.md                              # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ integration/                               # –ë–î + –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_db_orders.py
‚îÇ   ‚îú‚îÄ‚îÄ test_db_masters.py
‚îÇ   ‚îî‚îÄ‚îÄ conftest.py
‚îÇ
‚îî‚îÄ‚îÄ unit/                                      # –ß–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞
    ‚îú‚îÄ‚îÄ test_autoassign.py
    ‚îú‚îÄ‚îÄ test_commission_calc.py
    ‚îî‚îÄ‚îÄ test_warranty_priority.py
```

---

## üìù –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ —Ç–µ—Å—Ç–∞

```
================================================================================
üéØ –°–¶–ï–ù–ê–†–ò–ô 1: HAPPY PATH - –ü–æ–ª–Ω—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞
================================================================================

================================================================================
–≠–¢–ê–ü 1: –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑
================================================================================

  üë§ –ö–ª–∏–µ–Ω—Ç (ID=1000): –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞
  üì• –ö–ª–∏–µ–Ω—Ç ‚Üí –ë–æ—Ç: /start
  üîÑ FSM[–ö–ª–∏–µ–Ω—Ç]: None ‚Üí MainMenu
  üì± –ë–æ—Ç ‚Üí –ö–ª–∏–µ–Ω—Ç: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:... [+ –∫–Ω–æ–ø–∫–∏]
  üîµ –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É: 'üõ† –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑' (callback: create_order)
  üîÑ FSM[–ö–ª–∏–µ–Ω—Ç]: MainMenu ‚Üí OrderCreation:awaiting_address
  üì± –ë–æ—Ç ‚Üí –ö–ª–∏–µ–Ω—Ç: –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é:...
  üì• –ö–ª–∏–µ–Ω—Ç ‚Üí –ë–æ—Ç: –£–ª–∏—Ü–∞ –ë—Ä–∏–≤–∏–±–∞—Å 1, –†–∏–≥–∞
  ‚öôÔ∏è  –°–ò–°–¢–ï–ú–ê: –ü–∞—Ä—Å–∏–Ω–≥ –∞–¥—Ä–µ—Å–∞ (–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API)
  üîç –ë–î[cities]: SELECT * FROM cities WHERE name ILIKE '%–†–∏–≥–∞%' ‚Üí {'id': 1, 'name': '–†–∏–≥–∞'}
  üíæ –ë–î[temp_order_data].UPDATE: {"address": "–£–ª–∏—Ü–∞ –ë—Ä–∏–≤–∏–±–∞—Å 1, –†–∏–≥–∞", ...}
  ...

‚úÖ –£–°–ü–ï–•: –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'searching'

================================================================================
–≠–¢–ê–ü 2: –ê–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ - 1-–π —Ä–∞—É–Ω–¥
================================================================================

  ‚öôÔ∏è  –°–ò–°–¢–ï–ú–ê: Autoassign –∑–∞–ø—É—â–µ–Ω (Order ID=5001, City=–†–∏–≥–∞, Round=1)
  ‚è±Ô∏è  –¢–∏–∫ –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è: 0s
  üîç –ë–î[masters]: SELECT * FROM masters WHERE ... ‚Üí [{'id': 2001, ...}, ...]
  üíæ –ë–î[order_assignment_attempts].INSERT: {"order_id": 5001, "round": 1, ...}
    üì± –ë–æ—Ç ‚Üí –ú–∞—Å—Ç–µ—Ä –ò–≤–∞–Ω (ID=2001): üîî –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Ññ5001... [+ –∫–Ω–æ–ø–∫–∏]
    üì± –ë–æ—Ç ‚Üí –ú–∞—Å—Ç–µ—Ä –ü—ë—Ç—Ä (ID=2002): üîî –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Ññ5001... [+ –∫–Ω–æ–ø–∫–∏]
  ‚è±Ô∏è  –û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞: 35.0s
  ...

‚úÖ –£–°–ü–ï–•: –ó–∞–∫–∞–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä—É, SLA –≤—ã–ø–æ–ª–Ω–µ–Ω (35s < 120s)
```

---

## üéØ –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ `test_order_lifecycle_all_scenarios.py`
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é:

```python
@pytest.mark.e2e
async def test_scenario_N_your_scenario(bot_client, bot_master, db):
    """
    –°–¶–ï–ù–ê–†–ò–ô N: –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è
    
    –§–ª–æ—É: ...
    """
    log = TestLogger()
    log.section("–°–¶–ï–ù–ê–†–ò–ô N: –ù–∞–∑–≤–∞–Ω–∏–µ")
    
    # –í–∞—à —Ç–µ—Å—Ç
    log.action("–ö—Ç–æ-—Ç–æ", "–î–µ–ª–∞–µ—Ç —á—Ç–æ-—Ç–æ")
    log.button_click("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "–ö–Ω–æ–ø–∫–∞", "callback_data")
    log.db_write("table", "INSERT", {...})
    ...
    
    log.success("‚úÖ –°–¶–ï–ù–ê–†–ò–ô N –ó–ê–í–ï–†–®–Å–ù")
    return log.logs
```

3. –î–æ–±–∞–≤—å—Ç–µ –≤ `run_all_tests.py` –≤ —Å–ø–∏—Å–æ–∫ `scenarios`

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ!

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
# –¢–µ—Å—Ç–æ–≤–∞—è –ë–î
TEST_DATABASE_URL=postgresql://user:pass@localhost/test_db

# –¢–µ—Å—Ç–æ–≤—ã–µ –±–æ—Ç—ã
TEST_CLIENT_BOT_TOKEN=123456:ABC...
TEST_MASTER_BOT_TOKEN=789012:DEF...
TEST_ADMIN_BOT_TOKEN=345678:GHI...

# –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
TEST_CLIENT_ID=1000
TEST_MASTER_ID=2000
TEST_ADMIN_ID=3000
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–í–æ–ø—Ä–æ—Å—ã? –°–æ–∑–¥–∞–π—Ç–µ issue –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ Telegram: @your_support

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞!
