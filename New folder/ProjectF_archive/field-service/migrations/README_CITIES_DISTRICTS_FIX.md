# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤ –∏ —Ä–∞–π–æ–Ω–æ–≤ –≤ –∞–¥–º–∏–Ω-–±–æ—Ç–µ

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –≤ –∞–¥–º–∏–Ω-–±–æ—Ç–µ:
- **–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 21 –≥–æ—Ä–æ–¥** –∏–∑ 78 –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
- **–£ –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤ 0 —Ä–∞–π–æ–Ω–æ–≤** (–∫—Ä–æ–º–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞)
- –ì–æ—Ä–æ–¥–∞ –Ω–µ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –≤ –ë–î

## üîç –ü—Ä–∏—á–∏–Ω–∞

–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
SELECT COUNT(*) FROM cities WHERE is_active = true;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 21 (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 78)

SELECT COUNT(*) FROM districts;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 (—Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–π)
```

–í –∫–∞—Ç–∞–ª–æ–≥–µ `field_service/data/cities.py` –µ—Å—Ç—å –≤—Å–µ 78 –≥–æ—Ä–æ–¥–æ–≤, –Ω–æ –≤ –ë–î –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ –≤—Å–µ.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω—ã –¥–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞:

### 1Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö 78 –≥–æ—Ä–æ–¥–æ–≤
**–§–∞–π–ª:** `migrations/2025-10-07_add_all_cities.sql`
- –î–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ –≥–æ—Ä–æ–¥–∞ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ timezone
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ON CONFLICT DO UPDATE` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 2Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–π–æ–Ω–æ–≤ –¥–ª—è 20 –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
**–§–∞–π–ª:** `migrations/2025-10-07_add_districts.sql`
- –ú–æ—Å–∫–≤–∞ (12 –æ–∫—Ä—É–≥–æ–≤: –¶–ê–û, –°–ê–û, –°–í–ê–û, –í–ê–û, –Æ–í–ê–û, –Æ–ê–û, –Æ–ó–ê–û, –ó–ê–û, –°–ó–ê–û, –ó–µ–ª–ê–û, –ù–ê–û, –¢–ê–û)
- –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ (18 —Ä–∞–π–æ–Ω–æ–≤)
- –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ (10 —Ä–∞–π–æ–Ω–æ–≤)
- –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (7 —Ä–∞–π–æ–Ω–æ–≤)
- –ö–∞–∑–∞–Ω—å (7 —Ä–∞–π–æ–Ω–æ–≤)
- –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥ (8 —Ä–∞–π–æ–Ω–æ–≤)
- –ß–µ–ª—è–±–∏–Ω—Å–∫ (7 —Ä–∞–π–æ–Ω–æ–≤)
- –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ (7 —Ä–∞–π–æ–Ω–æ–≤)
- –°–∞–º–∞—Ä–∞ (9 —Ä–∞–π–æ–Ω–æ–≤)
- –£—Ñ–∞ (7 —Ä–∞–π–æ–Ω–æ–≤)
- –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É (8 —Ä–∞–π–æ–Ω–æ–≤)
- –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä (4 —Ä–∞–π–æ–Ω–∞)
- –û–º—Å–∫ (5 —Ä–∞–π–æ–Ω–æ–≤)
- –í–æ—Ä–æ–Ω–µ–∂ (6 —Ä–∞–π–æ–Ω–æ–≤)
- –ü–µ—Ä–º—å (7 —Ä–∞–π–æ–Ω–æ–≤)
- –í–æ–ª–≥–æ–≥—Ä–∞–¥ (8 —Ä–∞–π–æ–Ω–æ–≤)
- –°–∞—Ä–∞—Ç–æ–≤ (6 —Ä–∞–π–æ–Ω–æ–≤)
- –¢—é–º–µ–Ω—å (4 —Ä–∞–π–æ–Ω–∞)
- –¢–æ–ª—å—è—Ç—Ç–∏ (3 —Ä–∞–π–æ–Ω–∞)
- –ò–∂–µ–≤—Å–∫ (5 —Ä–∞–π–æ–Ω–æ–≤)

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```powershell
docker exec -i field-service-db psql -U field_service -d field_service -c "SELECT COUNT(*) as total, COUNT(*) FILTER (WHERE is_active = true) as active FROM cities;"
docker exec -i field-service-db psql -U field_service -d field_service -c "SELECT COUNT(*) FROM districts;"
```

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```powershell
# –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ 78 –≥–æ—Ä–æ–¥–æ–≤
docker exec -i field-service-db psql -U field_service -d field_service < migrations/2025-10-07_add_all_cities.sql

# –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–π–æ–Ω—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
docker exec -i field-service-db psql -U field_service -d field_service < migrations/2025-10-07_add_districts.sql
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ä–æ–¥–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 78+)
docker exec -i field-service-db psql -U field_service -d field_service -c "SELECT COUNT(*) as total FROM cities WHERE is_active = true;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–π–æ–Ω—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º
docker exec -i field-service-db psql -U field_service -d field_service -c "SELECT c.name as city, COUNT(d.id) as districts FROM cities c LEFT JOIN districts d ON d.city_id = c.id WHERE c.id IN (203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222) GROUP BY c.id, c.name ORDER BY c.name;"

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≥–æ—Ä–æ–¥–∞ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
docker exec -i field-service-db psql -U field_service -d field_service -c "SELECT name FROM cities WHERE is_active = true ORDER BY name;"
```

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –≤ –∞–¥–º–∏–Ω-–±–æ—Ç–µ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 21 –≥–æ—Ä–æ–¥
- ‚ùå –†–∞–π–æ–Ω–æ–≤ –Ω–µ—Ç –≤–æ–æ–±—â–µ
- ‚ùå –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –Ω–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ 78 –≥–æ—Ä–æ–¥–æ–≤ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- ‚úÖ –î–ª—è 20 –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã —Ä–∞–π–æ–Ω—ã
- ‚úÖ –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –±–µ–∑ —Ä–∞–π–æ–Ω–∞ (–∫–Ω–æ–ø–∫–∞ "üö´ –ë–µ–∑ —Ä–∞–π–æ–Ω–∞")
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```powershell
# –£–¥–∞–ª–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–π–æ–Ω—ã
docker exec -i field-service-db psql -U field_service -d field_service -c "DELETE FROM districts WHERE city_id IN (203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222);"

# –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥–Ω—ã–µ 21)
docker exec -i field-service-db psql -U field_service -d field_service -c "UPDATE cities SET is_active = false WHERE id > 222;"
```

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã cities:
```sql
CREATE TABLE cities (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    is_active BOOLEAN DEFAULT true,
    timezone VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã districts:
```sql
CREATE TABLE districts (
    id SERIAL PRIMARY KEY,
    city_id INTEGER NOT NULL REFERENCES cities(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(city_id, name)
);
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ –∏ —Ä–∞–π–æ–Ω–∞ –≤ –∫–æ–¥–µ:

1. **orders_service.list_cities()** –≤ `admin_bot/services/orders.py`:
   - –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `cities.py` (—Å –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≥–æ—Ä–æ–¥–æ–≤ –≤ –ë–î —Å `is_active = true`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ –≥–æ—Ä–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, –∏ –≤ –ë–î

2. **orders_service.list_districts()** –≤ —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ:
   - –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞–π–æ–Ω—ã –∏–∑ –ë–î –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ city_id
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (5 —Ä–∞–π–æ–Ω–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
   - –ï—Å–ª–∏ —Ä–∞–π–æ–Ω–æ–≤ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ "üö´ –ë–µ–∑ —Ä–∞–π–æ–Ω–∞"

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –∞–¥–º–∏–Ω-–±–æ—Ç —Å—Ä–∞–∑—É –Ω–∞—á–Ω—ë—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- –í—Å–µ 78 –≥–æ—Ä–æ–¥–æ–≤ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- –†–∞–π–æ–Ω—ã –¥–ª—è 20 –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–π–æ–Ω–æ–≤ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tools/load_geo_catalog.py` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ CSV
- –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL INSERT

## üìû –ü—Ä–æ–±–ª–µ–º—ã?

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —á—Ç–æ-—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —Ç–∞–∫:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker logs field-service-db`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏–∑ –®–∞–≥–∞ 3
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏
