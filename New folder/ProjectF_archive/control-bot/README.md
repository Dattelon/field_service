# 🤖 Field Service Control Bot

Telegram бот для управления ботами на продакшн сервере. **Работает в Docker контейнере на сервере 24/7.**

## 🎯 Возможности

✅ **Мониторинг:**
- Проверка статуса контейнеров
- Просмотр логов в реальном времени
- Проверка здоровья сервера (диск, память, heartbeat)

✅ **Управление:**
- Запуск/остановка ботов
- Перезапуск ботов
- Полный деплой с бэкапом

✅ **Безопасность:**
- Доступ только для владельца (по Telegram ID)
- Работает в изолированном Docker контейнере
- SSH соединение защищено

## 🚀 Установка на сервер (один раз)

### Автоматическая установка (РЕКОМЕНДУЕТСЯ)

```powershell
C:\ProjectF\install_control_bot.ps1
```

**Скрипт автоматически:**
- ✅ Создаст архив control-bot
- ✅ Загрузит на сервер
- ✅ Соберёт Docker образ
- ✅ Запустит контейнер
- ✅ Настроит автозапуск

### Ручная установка

```bash
# На сервере
cd /opt
# Загрузить control-bot директорию
tar -xzf control-bot.tar.gz
cd control-bot

# Проверить .env файл
nano .env
# ADMIN_ID должен быть твоим Telegram ID!

# Собрать и запустить
docker compose build
docker compose up -d

# Проверить логи
docker compose logs -f
```

## 📱 Использование

### В Telegram

1. Найди своего бота (имя из @BotFather)
2. Отправь `/start`
3. Появится меню управления

### Меню кнопок

```
┌─────────────────────────────┐
│  📊 Статус   │   📋 Логи    │
├─────────────────────────────┤
│ ▶️ Запустить │ ⏸️ Остановить│
├─────────────────────────────┤
│ 🔄 Перезапустить │ 🏥 Здоровье│
├─────────────────────────────┤
│       🚀 Деплой             │
└─────────────────────────────┘
```

## 🎮 Команды

- **📊 Статус** - Показать статус всех контейнеров
- **📋 Логи** - Последние 30 строк логов (admin/master bot)
- **▶️ Запустить** - Запустить оба бота
- **⏸️ Остановить** - Остановить оба бота
- **🔄 Перезапустить** - Graceful restart ботов
- **🏥 Здоровье** - Диск, память, heartbeat
- **🚀 Деплой** - Полный деплой (бэкап→сборка→миграции→рестарт)

## 🔧 Управление на сервере

### Проверить статус

```bash
ssh root@217.199.254.27
cd /opt/control-bot
docker compose ps
```

### Посмотреть логи

```bash
docker compose logs -f
```

### Перезапустить

```bash
docker compose restart
```

### Остановить

```bash
docker compose down
```

### Запустить

```bash
docker compose up -d
```

### Обновить бота

```bash
# Остановить
docker compose down

# Загрузить новый код
# (используй install_control_bot.ps1)

# Пересобрать и запустить
docker compose build
docker compose up -d
```

## 📊 Примеры использования

### Утренняя проверка
1. Открыть бота в Telegram
2. **📊 Статус** - всё работает?
3. **🏥 Здоровье** - ресурсы в порядке?

### Деплой после разработки
1. **🚀 Деплой**
2. Подтвердить
3. Подождать 5 минут
4. **📊 Статус** + **📋 Логи**

### Диагностика проблем
1. **📋 Логи** - найти ошибку
2. **🔄 Перезапустить** - попробовать исправить
3. **🏥 Здоровье** - проверить ресурсы

### Плановое обслуживание
1. **⏸️ Остановить** боты
2. (работа на сервере)
3. **▶️ Запустить** боты

## 🔍 Мониторинг

### Логи control-bot

```bash
ssh root@217.199.254.27
cd /opt/control-bot
docker compose logs -f
```

### Проверка что бот работает

```bash
docker compose ps
# Должен быть: fs_control_bot (running)
```

### Heartbeat

```bash
# Последние сообщения от бота
docker compose logs --tail=20
```

## 🆘 Troubleshooting

### Бот не отвечает в Telegram

```bash
# Проверить что контейнер запущен
docker compose ps

# Посмотреть логи на ошибки
docker compose logs --tail=100

# Проверить .env файл
cat .env

# Перезапустить
docker compose restart
```

### SSH ошибки

```bash
# Проверить что SSH работает на сервере
systemctl status sshd

# Проверить пароль в .env
cat .env | grep PASSWORD
```

### Неправильный ADMIN_ID

```bash
# Узнать свой Telegram ID: @userinfobot
# Обновить .env
nano .env
# ADMIN_ID=твой_id

# Перезапустить
docker compose restart
```

## 🎯 Преимущества Docker запуска

✅ **Всегда работает** - контейнер перезапускается автоматически
✅ **Изолирован** - не влияет на другие сервисы
✅ **Легко обновлять** - просто пересобрать образ
✅ **Логи централизованы** - через docker compose logs
✅ **Не нужен локальный Python** - всё в контейнере

## 📁 Структура файлов

```
/opt/control-bot/
├── control_bot.py       # Код бота
├── requirements.txt     # Зависимости Python
├── Dockerfile          # Docker образ
├── docker-compose.yml  # Конфигурация запуска
├── .env               # Конфигурация (токены, пароли)
└── README.md          # Эта документация
```

## 🔐 Безопасность

- ✅ Только ты можешь использовать (проверка ADMIN_ID)
- ✅ Пароли в .env (не в git)
- ✅ SSH соединение защищено
- ✅ Контейнер изолирован
- ✅ Нет открытых портов (только SSH)

## 📝 Конфигурация

### .env файл

```bash
BOT_TOKEN=8226969985:AAH_qXGdPKAEfKuQ-WHZZqaEgPBnzoiK8L0
ADMIN_ID=332786197              # ТВО Telegram ID!
SERVER_HOST=217.199.254.27      # IP сервера
SERVER_USER=root
SERVER_PASSWORD=owo?8x-YA@vRN*
```

**ВАЖНО:** Обнови ADMIN_ID на свой! Узнай у @userinfobot в Telegram.

## 🎓 Советы

1. **Добавь бота в избранное** в Telegram для быстрого доступа
2. **Проверяй статус утром** перед началом работы
3. **Используй деплой** через бота вместо скриптов
4. **Смотри логи** после каждого деплоя
5. **Heartbeat** показывает что боты живы

## 🔗 Связанные скрипты

- `install_control_bot.ps1` - Установка бота на сервер
- `deploy_to_production.ps1` - Деплой через PowerShell (альтернатива)
- `check_server_health.ps1` - Проверка здоровья (альтернатива)

## 🎉 Готово!

Теперь у тебя есть **полноценный управляющий бот** который работает **24/7 в Docker** на сервере!

**Управляй production ботами из любой точки мира через Telegram!** 🚀

---

**Версия**: 1.0  
**Дата**: 10 октября 2025  
**Локация**: Docker контейнер на /opt/control-bot
